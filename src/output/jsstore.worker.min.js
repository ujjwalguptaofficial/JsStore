/*!
 * @license :jsstore - V2.0.0 - 10/04/2018
 * https://github.com/ujjwalguptaofficial/JsStore
 * Copyright (c) 2018 @Ujjwal Gupta; Licensed MIT
 */!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var n,o,i,s,c,u,a;r.r(t),function(e){e.First="f",e.Last="l",e.Any="a"}(n||(n={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(i||(i={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null"}(s||(s={})),function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.BadDataType="bad_data_type",e.NextJoinNotExist="next_join_not_exist",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbUndefined="indexeddb_undefined",e.IndexedDbBlocked="indexeddb_blocked"}(c||(c={})),function(e){e.Where="where",e.Like="like",e.In="in",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Or="or",e.Count="count",e.Skip="skip",e.Limit="limit",e.And="and"}(u||(u={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(a||(a={}));var h,l=function(){function e(){}return e._isLogEnabled=!1,e}(),f=function(){function e(e,t){void 0===t&&(t=null),this.type=e,this.info_=t,this.message=this.getMsg_()}return e.prototype.throw=function(){throw this.get()},e.log=function(e){l._isLogEnabled&&console.log(e)},e.prototype.logError=function(){console.error(this.get())},e.prototype.logWarning=function(){console.warn(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg_=function(){var e;switch(this.type){case c.NotArray:e="Supplied value is not an array";break;case c.UndefinedColumn:e="Column is undefined in Where";break;case c.UndefinedValue:e="Value is undefined in Where";break;case c.UndefinedColumnName:e="Column name is undefined '"+this.info_.TableName+"'";break;case c.UndefinedDbName:e="Database name is not supplied";break;case c.UndefinedColumnValue:e="Column value is undefined";break;case c.NoValueSupplied:e="No value supplied";break;case c.InvalidOp:e="Invalid Op Value '"+this.info_.Op+"'";break;case c.ColumnNotExist:e="Column '"+this.info_.ColumnName+"' does not exist";break;case c.EnableSearchOff:e="Search is turned off for the Column '"+this.info_.ColumnName+"'";break;case c.NullValue:e="Null value is not allowed for column '"+this.info_.ColumnName+"'";break;case c.BadDataType:e="Supplied value for column '"+this.info_.ColumnName+"' does not have valid type";break;case c.NextJoinNotExist:e="Next join details not supplied";break;case c.TableNotExist:e="Table '"+this.info_.TableName+"' does not exist";break;case c.DbNotExist:e="Database '"+this.info_.DbName+"' does not exist";break;case c.NotObject:e="supplied value is not object";break;case c.InvalidOp:e="Invalid Config '"+this.info_.Config+" '";case c.DbBlocked:e="database is blocked, cant be deleted right now";default:e=this.message}return e},e}(),p=function(){function e(e,t){this.onSuccess_=e,this.onError_=t,this.dbName_=y.activeDb.name}return e.prototype.deleteMetaData=function(){var e=this;N("JsStore_"+this.dbName_+"_Db_Version"),y.activeDb.tables.forEach(function(t){N("JsStore_"+e.dbName_+"_"+t.name+"_Version"),t.columns.forEach(function(e){e.autoIncrement&&N("JsStore_"+this._dbName+"_"+t.name+"_"+e.name+"_Value")})}),this.getDbList_(function(t){t.splice(t.indexOf(e.dbName_),1),y.setDbList(t)}),N("JsStore_"+this.dbName_+"_Schema",this.onSuccess_)},e.prototype.getDbList_=function(e){y.getDbList(e)},e.prototype.deleteDb=function(){var e=this;setTimeout(function(){var t=indexedDB.deleteDatabase(e.dbName_);t.onblocked=function(){null!=e.onError_&&e.onError_(new f(c.DbBlocked).get())},t.onerror=function(t){null!=e.onError_&&e.onError_(event.target.error)},t.onsuccess=function(){y.dbStatus.conStatus=i.Closed,e.deleteMetaData()}},100)},e}(),y=function(){function e(){}return e.callDbDroppedByBrowser=function(e){this.dbStatus.conStatus===i.Connected&&(this.isDbDeletedByBrowser=!0,!0===e&&new p(this.onDbDroppedByBrowser,null).deleteMetaData())},e.createTransaction=function(e,t,r){var n=this;null===this.transaction&&(r=r||a.ReadWrite,this.transaction=this.dbConnection.transaction(e,r),this.transaction.oncomplete=function(){n.transaction=null,t()},this.transaction.ontimeout=function(){n.transaction=null,console.error("transaction timed out")})},e.setDbList=function(e){A("database_list",e)},e.updateDbStatus=function(e,t){void 0===t?this.dbStatus.conStatus=e:this.dbStatus={conStatus:e,lastError:t}},e.getDbList=function(e){j("Database_List",function(t){e(t=null==t?[]:t)})},e.getDbVersion=function(e,t){j("JsStore_"+e+"_Db_Version",function(e){t.call(this,Number(e))}.bind(this))},e.getDbSchema=function(e,t){j("JsStore_"+e+"_Schema",function(e){t(e)})},e.transaction=null,e.activeDbVersion=0,e.dbStatus={conStatus:i.NotStarted,lastError:null},e}();!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_connected"}(h||(h={}));var d,b,_,g,v=function(){function e(){this.results=null,this.errorOccured=!1,this.errorCount=0}return e.prototype.onErrorOccured=function(e){++this.errorCount,1===this.errorCount&&null!=this.onError&&this.onError(e.target.error),console.error(e)},e}(),m=function(){function e(){}return e.callDbDroppedByBrowser=function(){this._isDbDeletedByBrowser=T.dbStatus.conStatus===h.Connected},e.createTransaction=function(e,t,r){var n=this;null===this._transaction&&(r=r||"readwrite",this._transaction=this._dbConnection.transaction(e,r),this._transaction.oncomplete=function(){n._transaction=null,t()},this._transaction.ontimeout=function(){this._transaction=null,console.error("transaction timed out")})},e._transaction=null,e}(),O=(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),k=function(e){function t(t,r,n){var o=e.call(this)||this;return o.rowAffected=0,o.key=t,o.onSuccess=r,o.onError=n,o}return O(t,e),t.prototype.execute=function(){var e=this;this.initTransaction();var t,r,n;this.errorOccured||(t=T.columnName,r=this.key,(n=e.objectStore.index(t).openCursor(IDBKeyRange.only(r))).onerror=function(t){e.errorOccured=!0,e.onErrorOccured(t)},n.onsuccess=function(t){var r=t.target.result;r&&(r.delete(),++e.rowAffected,r.continue())})},t.prototype.initTransaction=function(){m.createTransaction([T.tableName],this.onTransactionCompleted.bind(this)),this.objectStore=m._transaction.objectStore(T.tableName)},t.prototype.onTransactionCompleted=function(){!1===this.errorOccured&&this.onSuccess(this.rowAffected)},t}(v),S=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),w=function(e){function t(t,r,n){var o=e.call(this)||this;try{o.query=t,o.onSuccess=r,o.onError=n}catch(e){console.error(e)}return o}return S(t,e),t.prototype.execute=function(){var e,t=this,r=function(){t.objectStore.add(t.query).onerror=function(e){t.errorOccured=!0,t.onErrorOccured(e)}};this.initTransaction(),(e=t.objectStore.index(T.columnName).openCursor(IDBKeyRange.only(t.query[T.columnName]))).onsuccess=function(e){var n=e.target.result;n?n.update(t.query):r()},e.onerror=function(e){t.errorOccured=!0,t.onErrorOccured(e)}},t.prototype.initTransaction=function(){m.createTransaction([T.tableName],this.onTransactionCompleted.bind(this)),this.objectStore=m._transaction.objectStore(T.tableName)},t.prototype.onTransactionCompleted=function(){!1===this.errorOccured&&this.onSuccess&&this.onSuccess(null)},t}(v),C=function(){return function(e,t,r){var n=self.indexedDB.open(e,1);m._isDbDeletedByBrowser=!1,n.onerror=function(e){"InvalidStateError"===e.target.error.name&&(y.dbStatus={conStatus:i.UnableToStart,lastError:c.IndexedDbBlocked}),null!=r&&r(e.target.error)},n.onsuccess=function(e){T.dbStatus.conStatus=h.Connected,m._dbConnection=n.result,m._dbConnection.onclose=function(){m.callDbDroppedByBrowser(),E.updateDbStatus(h.Closed,c.ConnectionClosed)},m._dbConnection.onversionchange=function(e){null===e.newVersion&&(e.target.close(),m.callDbDroppedByBrowser(),E.updateDbStatus(h.Closed,c.ConnectionClosed))},m._dbConnection.onerror=function(e){T.dbStatus.lastError="Error occured in connection :"+e.target.result},m._dbConnection.onabort=function(e){T.dbStatus={conStatus:h.Closed,lastError:"Connection aborted"}},null!=t&&t()},n.onupgradeneeded=function(e){e.target.result.createObjectStore(T.tableName,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}(),q=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),x=function(e){function t(t,r,n){var o=e.call(this)||this;return o.key=t,o.onSuccess=r,o.onError=n,o}return q(t,e),t.prototype.execute=function(){var e,t,r,n=this;this.initTransaction_(),e=T.columnName,t=this.key,(r=n.objectStore.index(e).openCursor(IDBKeyRange.only(t))).onerror=function(e){n.errorOccured=!0,n.onErrorOccured(e)},r.onsuccess=function(e){var t=e.target.result;t&&(n.results=t.value.Value)}},t.prototype.initTransaction_=function(){m.createTransaction([T.tableName],this.onTransactionCompleted_,"readonly"),this.objectStore=m._transaction.objectStore(T.tableName)},t.prototype.onTransactionCompleted_=function(){!1===this.errorOccured&&this.onSuccess(this.results)},t}(v),D=function(){function e(e){void 0===e&&(e=null),this.onSuccess=e}return e.prototype.set=function(e,t,r){new w(e,t,r).execute()},e.prototype.remove=function(e,t,r){new k(e,t,r).execute()},e.prototype.get=function(e,t,r){new x(e,t,r).execute()},e.prototype.createDb=function(e,t){new C("KeyStore",e,t)},e.prototype.checkConnectionAndExecuteLogic=function(e){var t=this;if("create_db"===e.Name||"open_db"===e.Name)this.executeLogic(e);else switch(T.dbStatus.conStatus){case h.Connected:this.executeLogic(e);break;case h.NotStarted:setTimeout(function(){this.checkConnectionAndExecuteLogic(e)}.bind(this),100);break;case h.Closed:m._isDbDeletedByBrowser&&this.createDb(function(){m._isDbDeletedByBrowser=!1,t.checkConnectionAndExecuteLogic(e)},function(e){console.error(e)})}},e.prototype.returnResult=function(e){this.onSuccess&&this.onSuccess(e)},e.prototype.executeLogic=function(e){var t=this,r=function(e){t.returnResult({ReturnedValue:e})},n=function(e){t.returnResult({ErrorDetails:e,ErrorOccured:!0})};switch(e.Name){case"get":this.get(e.Query,r,n);break;case"set":this.set(e.Query,r,n);break;case"remove":this.remove(e.Query,r,n);break;case"create_db":this.createDb(r,n)}},e}(),T=function(){function e(){}return e.prcoessQuery=function(e){this.requestQueue.push(e),1===this.requestQueue.length&&this.executeCode()},e.executeCode=function(){var e=this;if(!this.isCodeExecuting&&this.requestQueue.length>0){this.isCodeExecuting=!0;var t={Name:this.requestQueue[0].Name,Query:this.requestQueue[0].Query};new D(function(t){e.onQueryFinished(t)}).checkConnectionAndExecuteLogic(t)}},e.onQueryFinished=function(e){var t=this.requestQueue.shift();this.isCodeExecuting=!1,e.ErrorOccured?t.OnError?t.OnError(e.ErrorDetails):console.error(e.ErrorDetails):t.OnSuccess&&t.OnSuccess(e.ReturnedValue),this.executeCode()},e.requestQueue=[],e.tableName="LocalStore",e.columnName="Key",e.isCodeExecuting=!1,e.dbStatus={conStatus:h.NotStarted,lastError:""},e}(),E=function(){function e(){}return e.setDbType=function(){indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),indexedDB?(IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):y.dbStatus={conStatus:i.UnableToStart,lastError:c.IndexedDbUndefined}},e.updateDbStatus=function(e,t){void 0===t?T.dbStatus.conStatus=e:T.dbStatus={conStatus:e,lastError:t}},e}(),j=function(e,t,r){void 0===r&&(r=null),T.prcoessQuery({Name:"get",OnError:r,OnSuccess:t,Query:e})},A=function(e,t,r,n){var o={Key:e,Value:t};T.prcoessQuery({Name:"set",OnError:n,OnSuccess:r,Query:o})},N=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),T.prcoessQuery({Name:"remove",OnError:r,OnSuccess:t,Query:e})},L=function(){function e(e,t){this.dbName_=y.activeDb.name,this.onSuccess_=e,this.onError_=t}return Object.defineProperty(e.prototype,"dbStatus_",{get:function(){return y.dbStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dbConnection_",{get:function(){return y.dbConnection},set:function(e){y.dbConnection=e},enumerable:!0,configurable:!0}),e.prototype.updateDbStatus_=function(e,t){y.updateDbStatus(e,t)},e.prototype.onDbDroppedByBrowser_=function(e){y.callDbDroppedByBrowser(e)},e.prototype.execute=function(){var e=this;if(this.dbName_.length>0){var t=indexedDB.open(this.dbName_,y.activeDbVersion);t.onerror=function(t){null!=e.onError_&&e.onError_(t.target.error)},t.onsuccess=function(r){e.dbStatus_.conStatus=i.Connected,e.dbConnection_=t.result,e.dbConnection_.onclose=function(t){e.onDbDroppedByBrowser_(),e.updateDbStatus_(i.Closed,c.ConnectionClosed)},e.dbConnection_.onversionchange=function(t){null===t.newVersion&&null===t.newVersion&&(t.target.close(),e.onDbDroppedByBrowser_(!0),e.updateDbStatus_(i.Closed,c.ConnectionClosed))},y.dbConnection.onerror=function(e){y.dbStatus.lastError="Error occured in connection :"+e.target.result},y.dbConnection.onabort=function(e){y.dbStatus={conStatus:i.Closed,lastError:c.ConnectionAborted}},null!=e.onSuccess_&&e.onSuccess_(),e.setPrimaryKey_()}}else{new f(c.UndefinedDbName).throw()}},Object.defineProperty(e.prototype,"activeDb_",{get:function(){return y.activeDb},enumerable:!0,configurable:!0}),e.prototype.setPrimaryKey_=function(){this.activeDb_.tables.forEach(function(e,t){e.columns.every(function(e){return y.activeDb.tables[t].primaryKey=e.primaryKey?e.name:"",!e.primaryKey})})},e}(),I=function(){function e(e){this.columns=[],this.requireDelete=!1,this.requireCreation=!1,this.name=e.name,this.version=e.version,this.columns=e.columns,this.setPrimaryKey_()}return e.prototype.createMetaData=function(e,t){this.callback=t,this.setRequireDelete_(e),this.setDbVersion_(e)},e.prototype.setPrimaryKey_=function(){var e=this;this.columns.every(function(t){return e.primaryKey=t.primaryKey?t.name:"",!t.primaryKey})},e.prototype.setRequireDelete_=function(e){var t=this;j("JsStore_"+e+"_"+this.name+"_Version",function(e){null==e?t.requireCreation=!0:e<t.version&&(t.requireDelete=!0)})},e.prototype.setDbVersion_=function(e){y.activeDbVersion=y.activeDbVersion>this.version?y.activeDbVersion:this.version,A("JsStore_"+e+"_Db_Version",y.activeDbVersion),A("JsStore_"+e+"_"+this.name+"_Version",y.activeDbVersion,this.callback),this.version=y.activeDbVersion},e}(),F=function(){function e(e){this.tables=[],this.name=e.name,this.tables=e.tables}return e.prototype.createMetaData=function(e){var t=this,r=0,n=[],o=function(){if(r<t.tables.length){var i=t.tables[r],s=new I(i);s.createMetaData(t.name,function(){s.callback=null,n.push(s),o()}),++r}else e(n)};o()},e}(),B=function(){function e(e,t,r){var n=this;this.dbName_=this.activeDb_.name;var o=[],s=indexedDB.open(this.dbName_,this.dbVersion_);s.onerror=function(e){null!=r&&r(e.target.error)},s.onsuccess=function(e){n.dbStatus_.conStatus=i.Connected,n.dbConnection_=s.result,n.dbConnection_.onclose=function(e){y.callDbDroppedByBrowser(),y.updateDbStatus(i.Closed,c.ConnectionClosed)},n.dbConnection_.onversionchange=function(e){null===e.newVersion&&(e.target.close(),y.callDbDroppedByBrowser(!0),y.updateDbStatus(i.Closed,c.ConnectionClosed))},n.dbConnection_.onerror=function(e){y.dbStatus.lastError="Error occured in connection :"+e.target.result},n.dbConnection_.onabort=function(e){n.dbStatus_={conStatus:i.Closed,lastError:c.ConnectionAborted}},n.saveDbName(),null!=t&&t(o)},s.onupgradeneeded=function(t){var r=t.target.result,i=function(e,t){try{if(e.primaryKey.length>0){y.activeDb.tables[t].primaryKey=e.primaryKey;var i=r.createObjectStore(e.name,{keyPath:e.primaryKey});e.columns.forEach(function(t){if(!0===t.enableSearch){var r=t.primaryKey?{unique:!0}:{unique:t.unique};r.multiEntry=t.multiEntry,i.createIndex(t.name,t.name,r),t.autoIncrement&&A("JsStore_"+n.dbName_+"_"+e.name+"_"+t.name+"_Value",0)}})}else{var s=r.createObjectStore(e.name,{autoIncrement:!0});e.columns.forEach(function(t){var r={unique:t.unique,multiEntry:t.multiEntry};s.createIndex(t.name,t.name,r),t.autoIncrement&&A("JsStore_"+n.dbName_+"_"+e.name+"_"+t.name+"_Value",0)})}o.push(e.name),A("JsStore_"+n.dbName_+"_"+e.name+"_Version",e.version)}catch(e){console.error(e)}};e.forEach(function(e,t){e.requireDelete?(r.objectStoreNames.contains(e.name)&&r.deleteObjectStore(e.name),i(e,t)):e.requireCreation&&i(e,t)})}}return Object.defineProperty(e.prototype,"activeDb_",{get:function(){return y.activeDb},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dbVersion_",{get:function(){return y.activeDbVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dbStatus_",{get:function(){return y.dbStatus},set:function(e){y.dbStatus=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dbConnection_",{set:function(e){y.dbConnection=e},enumerable:!0,configurable:!0}),e.prototype.getDbList_=function(e){y.getDbList(e)},e.prototype.saveDbName=function(){var e=this;this.getDbList_(function(t){t.indexOf(e.dbName_)<0&&(t.push(e.dbName_),y.setDbList(t))})},e}(),Q=function(){return function(e,t){null!=e.name?this.name=e.name:new f(c.UndefinedColumnName,{TableName:t}).throw(),this.autoIncrement=null!=e.autoIncrement&&e.autoIncrement,this.primaryKey=null!=e.primaryKey&&e.primaryKey,this.unique=null!=e.unique&&e.unique,this.notNull=null!=e.notNull&&e.notNull,this.dataType=null!=e.dataType?e.dataType:e.autoIncrement?"number":null,this.default=e.default,this.multiEntry=null!=e.multiEntry&&e.multiEntry,this.enableSearch=null==e.enableSearch||e.enableSearch}}(),R=function(){return function(e){var t=this;this.columns=[],this.name=e.name,this.version=null==e.version?1:e.version,e.columns.forEach(function(r){t.columns.push(new Q(r,e.name))})}}(),P=function(){return function(e){var t=this;this.tables=[],this.name=e.name,e.tables.forEach(function(e){t.tables.push(new R(e))})}}(),V=function(){function e(){}return e.isNull=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0===e.length;case"number":return isNaN(e)}return!1},e.getObjectFirstKey=function(e){for(var t in e)return t;return null},e.getType=function(e){if(null===e)return s.Null;var t=typeof e;switch(t){case"object":if(Array.isArray(e))return s.Array;default:return t}},e}(),K=function(){function e(){this.filterOnOccurence=function(e){var t=!1;switch(e=e.toLowerCase(),this._compSymbol){case n.Any:e.indexOf(this._compValue)>=0&&(t=!0);break;case n.First:0===e.indexOf(this._compValue)&&(t=!0);break;case n.Last:e.lastIndexOf(this._compValue)===e.length-this._compValueLength&&(t=!0);break;default:e!==this._compValue&&(t=!0)}return t}}return Object.defineProperty(e.prototype,"activeDb",{get:function(){return y.activeDb},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dbConnection",{get:function(){return y.dbConnection},enumerable:!0,configurable:!0}),e.prototype.getObjectFirstKey=function(e){return V.getObjectFirstKey(e)},e.prototype.isNull=function(e){return V.isNull(e)},e.prototype.getType=function(e){return V.getType(e)},Object.defineProperty(e.prototype,"transaction",{get:function(){return y.transaction},enumerable:!0,configurable:!0}),e.prototype.createTransaction=function(e,t,r){y.createTransaction(e,t)},e.prototype.containsNot=function(e){var t=!1;return Object.keys(e).every(function(r){return e[r]["!="]&&(t=!0),!t}),t},e.prototype.isTableExist=function(e){var t=!1;return this.activeDb.tables.every(function(r){return r.name!==e||(t=!0,!1)}),t},e.prototype.getTable=function(e){var t;return this.activeDb.tables.every(function(r){return r.name!==e||(t=r,!1)}),t},e.prototype.getKeyRange=function(e,t){var r;switch(t){case u.Between:r=IDBKeyRange.bound(e.low,e.high,!1,!1);break;case u.GreaterThan:r=IDBKeyRange.lowerBound(e,!0);break;case u.GreaterThanEqualTo:r=IDBKeyRange.lowerBound(e);break;case u.LessThan:r=IDBKeyRange.upperBound(e,!0);break;case u.LessThanEqualTo:r=IDBKeyRange.upperBound(e);break;default:r=IDBKeyRange.only(e)}return r},e.prototype.getPrimaryKey=function(e){var t=this.getTable(e).primaryKey;return t||this.getKeyPath(e)},e.prototype.getKeyPath=function(e){return this.dbConnection.transaction([e],"readonly").objectStore(e).keyPath},e.prototype.getAllCombinationOfWord=function(e,t){if(t){for(var r=[],n=0,o=e.length;n<o;n++)r=r.concat(this.getCombination_(e[n]));return r}return this.getCombination_(e)},e.prototype.getCombination_=function(e){var t=[],r=function(e,n,o){if(o===e.length)t.push(n.join(""));else{var i=e.charAt(o);n[o]=i.toLowerCase(),r(e,n,o+1),n[o]=i.toUpperCase(),r(e,n,o+1)}};return r(e,[],0),t},e}(),W=function(){function e(e){this.where=e}return e.prototype.check=function(e){var t;for(var r in this.status=!0,this.where){if(!this.status)break;if("object"==typeof(t=this.where[r]))for(var n in t){if(!this.status)break;switch(n){case u.In:this.checkIn(r,e[r]);break;case u.Like:this.checkLike(r,e[r]);break;case u.Between:case u.GreaterThan:case u.LessThan:case u.GreaterThanEqualTo:case u.LessThanEqualTo:case u.NotEqualTo:this.checkComparisionOp(r,e[r],n)}}else if(t!==e[r]){this.status=!1;break}}return this.status},e.prototype.checkIn=function(e,t){for(var r=0,n=this.where[e][u.In],o=n.length;r<o;r++){if(n[r]===t){this.status=!0;break}this.status=!1}},e.prototype.checkLike=function(e,t){var r,o,i,s=this.where[e][u.Like].split("%");switch(s[1]?(o=s[1],r=s.length>2?n.Any:n.Last):(o=s[0],r=n.First),t=t.toLowerCase(),r){case n.Any:(i=t.indexOf(o.toLowerCase()))<0&&(this.status=!1);break;case n.First:((i=t.indexOf(o.toLowerCase()))>0||i<0)&&(this.status=!1);break;default:(i=t.lastIndexOf(o.toLowerCase()))<t.length-o.length&&(this.status=!1)}},e.prototype.checkComparisionOp=function(e,t,r){var n=this.where[e][r];switch(r){case u.GreaterThan:t<=n&&(this.status=!1);break;case u.LessThan:t>=n&&(this.status=!1);break;case u.LessThanEqualTo:t>n&&(this.status=!1);break;case u.GreaterThanEqualTo:t<n&&(this.status=!1);break;case u.Between:(t<n.Low||t>n.High)&&(this.status=!1);break;case u.NotEqualTo:t===n&&(this.status=!1)}},e}(),J=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorOccured=!1,t.errorCount=0,t.rowAffected=0,t.checkFlag=!1,t.onCursorError=function(e){t.errorOccured=!0,t.onErrorOccured(e)},t.goToWhereLogic=function(){var e=this,t=this.getObjectFirstKey(this.query.where);if(!0===this.query.IgnoreCase&&(this.query.where=this.makeQryInCaseSensitive(this.query.where)),this.objectStore.indexNames.contains(t)){var r=this.query.where[t];if("object"==typeof r){this.checkFlag=Boolean(Object.keys(r).length>1||Object.keys(this.query.where).length>1),!0===this.checkFlag&&(this.whereCheckerInstance=new W(this.query.where));var o=this.getObjectFirstKey(r);switch(o){case u.Like:var i=r[u.Like].split("%"),s=void 0,a=void 0;i[1]?(s=i[1],a=i.length>2?n.Any:n.Last):(s=i[0],a=n.First),a===n.First?(this.getAllCombinationOfWord(s).forEach(function(r){e.executeWhereLogic(t,{"-":{low:r,high:r+"ï¿¿"}},"-")}),delete this.query.where[t][u.Like]):this.executeLikeLogic(t,s,a);break;case u.In:this.executeInLogic(t,r[u.In]);break;case u.Between:case u.GreaterThan:case u.LessThan:case u.GreaterThanEqualTo:case u.LessThanEqualTo:this.executeWhereLogic(t,r,o);break;case u.Aggregate:break;default:this.executeWhereLogic(t,r)}}else this.checkFlag=Boolean(Object.keys(this.query.where).length>1),!0===this.checkFlag&&(this.whereCheckerInstance=new W(this.query.where)),this.executeWhereLogic(t,r)}else{this.errorOccured=!0;var h=this.getColumnInfo(t),l=new f(null==h?c.ColumnNotExist:c.EnableSearchOff,{ColumnName:t});this.onErrorOccured(l,!0)}},t}return J(t,e),t.prototype.onErrorOccured=function(e,t){if(void 0===t&&(t=!1),++this.errorCount,1===this.errorCount)if(t)e.logError(),this.onError(e.get());else{var r=new f(e.target.error.name);r.message=e.target.error.message,r.logError(),this.onError(r.get())}},t.prototype.onExceptionOccured=function(e,t){switch(e.name){case"NotFoundError":var r=new f(c.TableNotExist,t);this.onErrorOccured(r,!0);break;default:console.error(e)}},t.prototype.getColumnInfo=function(e){var t;return this.getTable(this.tableName).columns.every(function(r){return r.name!==e||(t=r,!1)}),t},t.prototype.addGreatAndLessToNotOp=function(){var e,t=this.query.where;if(this.containsNot(t)){var r=Object.keys(t);if(1===r.length)r.forEach(function(r){(e=t[r])[u.NotEqualTo]&&(t[r][u.GreaterThan]=e[u.NotEqualTo],void 0===t[u.Or]?(t[u.Or]={},t[u.Or][r]={}):void 0===t[u.Or][r]&&(t[u.Or][r]={}),t[u.Or][r][u.LessThan]=e[u.NotEqualTo],delete t[r][u.NotEqualTo])}),this.query.where=t;else{var n=[];r.forEach(function(r){var o={};(e=t[r])[u.NotEqualTo]?(o[r]={},o[r][u.GreaterThan]=e[u.NotEqualTo],o[r][u.Or]={},o[r][u.Or][r]={},o[r][u.Or][r][u.LessThan]=e[u.NotEqualTo]):o[r]=e,n.push(o)}),this.query.where=n}}},t.prototype.makeQryInCaseSensitive=function(e){var t,r,n=[];for(var o in e)if("object"==typeof(t=e[o])){for(var i in t)switch(r=t[i],i){case u.In:n=n.concat(this.getAllCombinationOfWord(r,!0));break;case u.Like:break;default:n=n.concat(this.getAllCombinationOfWord(r))}e[o][u.In]=n}else n=n.concat(this.getAllCombinationOfWord(t)),e[o]={},e[o][u.In]=n;return e},t}(K),G=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.results=[],t.sorted=!1,t}return G(t,e),t.prototype.removeDuplicates=function(){var e=this.results;this.results=void 0;var t=this.getPrimaryKey(this.query.from),r={};for(var n in e)r[e[n][t]]=e[n];for(var n in e=[],r)e.push(r[n]);this.results=e},t.prototype.onQueryFinished=function(){},t}(U),z=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return z(t,e),t.prototype.executeWhereUndefinedLogic=function(){if(this.query.order&&this.query.order.by)if(this.objectStore.indexNames.contains(this.query.order.by)){var e=this.query.order.Type&&"desc"===this.query.order.Type.toLowerCase()?"prev":"next";this.sorted=!0,this.cursorOpenRequest=this.objectStore.index(this.query.order.by).openCursor(null,e)}else{new f(c.ColumnNotExist,{ColumnName:this.query.order.by}).throw()}else this.cursorOpenRequest=this.objectStore.openCursor();this.skipRecord&&this.limitRecord?this.executeSkipAndLimitForNoWhere_():this.skipRecord?this.executeSkipForNoWhere_():this.limitRecord?this.executeLimitForNotWhere_():this.executeSimpleForNotWhere_(),this.cursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t.prototype.executeSkipAndLimitForNoWhere_=function(){var e,t=this,r=!1;this.cursorOpenRequest.onsuccess=function(n){(e=n.target.result)?r&&t.results.length!==t.limitRecord?(t.results.push(e.value),e.continue()):(r=!0,e.advance(t.skipRecord)):t.onQueryFinished()}},t.prototype.executeSkipForNoWhere_=function(){var e,t=this,r=!1;this.cursorOpenRequest.onsuccess=function(n){(e=n.target.result)?r?(t.results.push(e.value),e.continue()):(r=!0,e.advance(t.skipRecord)):t.onQueryFinished()}},t.prototype.executeSimpleForNotWhere_=function(){var e;this.cursorOpenRequest.onsuccess=function(t){(e=t.target.result)?(this.results.push(e.value),e.continue()):this.onQueryFinished()}.bind(this)},t.prototype.executeLimitForNotWhere_=function(){var e,t=this;this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&t.results.length!==t.limitRecord?(t.results.push(e.value),e.continue()):t.onQueryFinished()}},t}(M),X=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return X(t,e),t.prototype.executeInLogic=function(e,t){this.skipRecord&&this.limitRecord?this.executeSkipAndLimitForIn_(e,t):this.skipRecord?this.executeSkipForIn_(e,t):this.limitRecord?this.executeLimitForIn_(e,t):this.executeSimpleForIn_(e,t)},t.prototype.executeSkipAndLimitForIn_=function(e,t){var r,n,o=this,i=this.skipRecord,s=this.objectStore.index(e),c=function(e){0===i?o.results.push(e):--i},u=function(e){o.errorOccured=!0,o.onErrorOccured(e)};if(this.checkFlag)for(var a=function(e,i){h.errorOccured||((n=s.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){r=t.target.result,o.results.length!==o.limitRecord&&r?(o.whereCheckerInstance.check(r.value)&&c(r.value),r.continue()):e+1===i&&o.onQueryFinished()},n.onerror=u)},h=this,l=0,f=t.length;l<f;l++)a(l,f);else for(var p=function(e,i){y.errorOccured||((n=s.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){r=t.target.result,o.results.length!==o.limitRecord&&r?(c(r.value),r.continue()):e+1===i&&o.onQueryFinished()},n.onerror=u)},y=this,d=(l=0,t.length);l<d;l++)p(l,d)},t.prototype.executeSkipForIn_=function(e,t){var r,n,o=this,i=this.skipRecord,s=this.objectStore.index(e),c=function(e){0===i?o.results.push(e):--i},u=function(e){o.errorOccured=!0,o.onErrorOccured(e)};if(this.checkFlag)for(var a=function(e,i){h.errorOccured||((n=s.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(o.whereCheckerInstance.check(r.value)&&c(r.value),r.continue()):e+1===i&&o.onQueryFinished()},n.onerror=u)},h=this,l=0,f=t.length;l<f;l++)a(l,f);else for(var p=function(e,i){y.errorOccured||((n=s.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(c(r.value),r.continue()):e+1===i&&o.onQueryFinished()},n.onerror=u)},y=this,d=(l=0,t.length);l<d;l++)p(l,d)},t.prototype.executeLimitForIn_=function(e,t){var r,n,o=this,i=this.objectStore.index(e),s=function(e){o.errorOccured=!0,o.onErrorOccured(e)};if(this.checkFlag)for(var c=function(e,c){u.errorOccured||((n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)&&o.results.length!==o.limitRecord?(o.whereCheckerInstance.check(r.value)&&o.results.push(r.value),r.continue()):e+1===c&&o.onQueryFinished()},n.onerror=s)},u=this,a=0,h=t.length;a<h;a++)c(a,h);else for(var l=function(e,c){f.errorOccured||((n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)&&o.results.length!==o.limitRecord?(o.results.push(r.value),r.continue()):e+1===c&&o.onQueryFinished()},n.onerror=s)},f=this,p=(a=0,t.length);a<p;a++)l(a,p)},t.prototype.executeSimpleForIn_=function(e,t){var r,n,o=this,i=this.objectStore.index(e),s=function(e){o.errorOccured=!0,o.onErrorOccured(e)};if(this.checkFlag)for(var c=function(e,c){u.errorOccured||((n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(o.whereCheckerInstance.check(r.value)&&o.results.push(r.value),r.continue()):e+1===c&&o.onQueryFinished()},n.onerror=s)},u=this,a=0,h=t.length;a<h;a++)c(a,h);else for(var l=function(e,c){f.errorOccured||((n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(o.results.push(r.value),r.continue()):e+1===c&&o.onQueryFinished()},n.onerror=s)},f=this,p=(a=0,t.length);a<p;a++)l(a,p)},t}(H),Z=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.executeLikeLogic_=function(e,t,r){this.compValue=t.toLowerCase(),this.compValueLength=this.compValue.length,this.compSymbol=r,this.cursorOpenRequest=this.objectStore.index(e).openCursor(),this.cursorOpenRequest.onerror=this.onCursorError,this.skipRecord&&this.limitRecord?this.executeSkipAndLimit_():this.skipRecord?this.executeSkip_():this.limitRecord?this.executeLimit_():this.executeSimple_()},t.prototype.executeSkipAndLimit_=function(){var e,t=this,r=function(e){0===n?t.results.push(e):--n},n=this.skipRecord;this.checkFlag?this.cursorOpenRequest.onsuccess=function(n){e=n.target.result,t.results.length!==t.limitRecord&&e?(t.filterOnOccurence(e.key)&&t.whereCheckerInstance.check(e.value)&&r(e.value),e.continue()):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(n){e=n.target.result,t.results.length!==t.limitRecord&&e?(t.filterOnOccurence(e.key)&&r(e.value),e.continue()):t.onQueryFinished()}},t.prototype.executeSkip_=function(){var e,t=this,r=this.skipRecord,n=function(e){0===r?t.results.push(e):--r};this.checkFlag?this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)?(t.filterOnOccurence(e.key)&&t.whereCheckerInstance.check(e.value)&&n(e.value),e.continue()):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)?(t.filterOnOccurence(e.key)&&n(e.value),e.continue()):t.onQueryFinished()}},t.prototype.executeLimit_=function(){var e,t=this;this.checkFlag?this.cursorOpenRequest.onsuccess=function(r){e=r.target.result,t.results.length!==t.limitRecord&&e?(t.filterOnOccurence(e.key)&&t.whereCheckerInstance.check(e.value)&&t.results.push(e.value),e.continue()):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(r){e=r.target.result,t.results.length!==t.limitRecord&&e?(t.filterOnOccurence(e.key)&&t.results.push(e.value),e.continue()):t.onQueryFinished()}},t.prototype.executeSimple_=function(){var e,t=this;this.checkFlag?this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)?(t.filterOnOccurence(e.key)&&t.whereCheckerInstance.check(e.value)&&t.results.push(e.value),e.continue()):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)?(t.filterOnOccurence(e.key)&&t.results.push(e.value),e.continue()):t.onQueryFinished()}},t}(Y),ee=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ee(t,e),t.prototype.executeSkipAndLimitForWhere_=function(){var e,t=this,r=!1;this.checkFlag?this.cursorOpenRequest.onsuccess=function(n){(e=n.target.result)?r&&t.results.length!==t.limitRecord?(t.whereCheckerInstance.check(e.value)&&t.results.push(e.value),e.continue()):(r=!0,e.advance(t.skipRecord)):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(n){(e=n.target.result)?r&&t.results.length!==t.limitRecord?(t.results.push(e.value),e.continue()):(r=!0,e.advance(t.skipRecord)):t.onQueryFinished()}},t.prototype.executeSkipForWhere_=function(){var e,t=this,r=!1;this.checkFlag?this.cursorOpenRequest.onsuccess=function(n){(e=n.target.result)?r?(t.whereCheckerInstance.check(e.value)&&t.results.push(e.value),e.continue()):(r=!0,e.advance(t.skipRecord)):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(n){(e=n.target.result)?r?(t.results.push(e.value),e.continue()):(r=!0,e.advance(t.skipRecord)):t.onQueryFinished()}},t.prototype.executeLimitForWhere_=function(){var e,t=this;this.checkFlag?this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&t.results.length!==t.limitRecord&&t.whereCheckerInstance.check(e.value)?(t.results.push(e.value),e.continue()):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&t.results.length!==t.limitRecord?(t.results.push(e.value),e.continue()):t.onQueryFinished()}},t.prototype.executeSimpleForWhere_=function(){var e,t=this;this.checkFlag?this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)?(t.whereCheckerInstance.check(e.value)&&t.results.push(e.value),e.continue()):t.onQueryFinished()}:this.cursorOpenRequest.onsuccess=function(r){(e=r.target.result)?(t.results.push(e.value),e.continue()):t.onQueryFinished()}},t.prototype.executeWhereLogic_=function(e,t,r,n){var o=this;t=r?t[r]:t,this.cursorOpenRequest=this.objectStore.index(e).openCursor(this.getKeyRange(t,r),n),this.cursorOpenRequest.onerror=function(e){o.errorOccured=!0,o.onErrorOccured(e)},this.skipRecord&&this.limitRecord?this.executeSkipAndLimitForWhere_():this.skipRecord?this.executeSkipForWhere_():this.limitRecord?this.executeLimitForWhere_():this.executeSimpleForWhere_()},t}($),re=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ne=function(e){function t(){return e.call(this)||this}return re(t,e),t.prototype.processGroupBy=function(){var e=this.query.GroupBy,t=this.results,r={};if(this.results=this.query.GroupBy=void 0,"string"==typeof e)for(var n=0,o=Object.keys(t);n<o.length;n++){r[t[u=o[n]][e]]=t[u]}else for(var i=void 0,s=0,c=Object.keys(t);s<c.length;s++){var u=c[s];i="";for(var a=0,h=Object.keys(e);a<h.length;a++){var l=h[a];i+=t[u][e[l]]}r[i]=t[u]}t=[];for(var f=0,p=Object.keys(r);f<p.length;f++){u=p[f];t.push(r[u])}this.results=t},t.prototype.executeAggregateGroupBy=function(){var e,t,r,n,o=this,i=this.query.GroupBy,c=this.results,u={},a=this.query.aggregate;this.query.aggregate=void 0,this.results=void 0;var h=function(){for(var i=0,h=Object.keys(a);i<h.length;i++){var l=h[i];switch(l){case"Count":var f=function(){return r=(r=u[t])?r["Count("+n+")"]:0,r+=c[e][n]?1:0};if("string"==typeof a[l])n=a[l],c[e]["Count("+n+")"]=f();else if(Array.isArray(a[l]))for(var p in a[l])n=a[l][p],c[e]["Count("+n+")"]=f();break;case"max":var y=function(){return r=(r=u[t])?r["max("+n+")"]:0,c[e][n]=c[e][n]?c[e][n]:0,r>c[e][n]?r:c[e][n]};if("string"==typeof a[l])n=a[l],c[e]["max("+n+")"]=y();else if(Array.isArray(a[l]))for(var p in a[l])n=a[l][p],c[e]["max("+n+")"]=y();break;case"min":var d=function(){return r=(r=u[t])?r["min("+n+")"]:1/0,c[e][n]=c[e][n]?c[e][n]:1/0,r<c[e][n]?r:c[e][n]};if("string"==typeof a[l])n=a[l],c[e]["min("+n+")"]=d();else if(Array.isArray(a[l]))for(var p in a[l])n=a[l][p],c[e]["min("+n+")"]=d();break;case"Sum":var b=function(){return r=(r=u[t])?r["Sum("+n+")"]:0,r+=c[e][n]?c[e][n]:0};if("string"==typeof a[l])n=a[l],c[e]["Sum("+n+")"]=b();else if(o.getType(a[l])===s.Array)for(var p in a[l])n=a[l][p],c[e]["Sum("+n+")"]=b();break;case"Avg":var _=function(){var o=(r=u[t])?r["Sum("+n+")"]:0;o+=c[e][n]?c[e][n]:0,c[e]["Sum("+n+")"]=o,r=r?r["Count("+n+")"]:0,r+=c[e][n]?1:0,c[e]["Count("+n+")"]=r};if("string"==typeof a[l])n=a[l],_();else if(o.getType(a[l])===s.Array)for(var g=0,v=Object.keys(a[l]);g<v.length;g++){p=v[g];n=a[l][p],_()}}}};if(this.getType(i)===s.String)for(e in c)t=c[e][i],h(),u[t]=c[e];else for(e in c){for(var l in t="",i)t+=c[e][i[l]];h(),u[t]=c[e]}for(var f in c=[],u)c.push(u[f]);if(a.Avg)if(this.getType(a.Avg)===s.String)for(e in c){var p=c[e]["Sum("+a.Avg+")"],y=c[e]["Count("+a.Avg+")"];c[e]["Avg("+a.Avg+")"]=p/y,a.Count!==a.Avg&&delete c[e]["Count("+a.Avg+")"],a.Sum!==a.Avg&&delete c[e]["Sum("+a.Avg+")"]}else{var d=this.getType(a.Count)===s.String,b=this.getType(a.Count)===s.String;for(e in c)for(var l in a.Avg){var _=a.Avg[l],g=c[e]["Sum("+_+")"],v=c[e]["Count("+_+")"];c[e]["Avg("+_+")"]=g/v,d&&(a.Count!==_?delete c[e]["Count("+_+")"]:-1===a.Count.indexOf(_)&&delete c[e]["Count("+_+")"]),b&&(a.Sum!==_?delete c[e]["Sum("+_+")"]:-1===a.Sum.indexOf(_)&&delete c[e]["Sum("+_+")"])}}this.results=c},t}(te),oe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ie=function(e){function t(){return e.call(this)||this}return oe(t,e),t.prototype.processOrderBy=function(){var e=this,t=this.query.order;if(t&&this.results.length>0&&!this.sorted&&t.by){t.Type=t.Type?t.Type.toLowerCase():"asc";var r=t.by;typeof this.results[0][r]===s.String?"asc"===t.Type?e.results.sort(function(e,t){return e[r].toLowerCase().localeCompare(t[r].toLowerCase())}):e.results.sort(function(e,t){return t[r].toLowerCase().localeCompare(e[r].toLowerCase())}):typeof this.results[0][r]===s.Number&&("asc"===t.Type?e.results.sort(function(e,t){return e[r]-t[r]}):e.results.sort(function(e,t){return t[r]-e[r]}))}},t.prototype.processAggregateQry=function(){var e,t=this.results,r={};for(var n in this.results=void 0,this.query.Aggregate)switch(n){case"count":var o=function(){var r=0;for(var n in t)r+=t[n][e]?1:0;return r};if(this.getType(this.query.Aggregate[n])===s.String)r["count("+(e=this.query.Aggregate[n])+")"]=o();else if(this.getType(this.query.Aggregate[n])===s.Array)for(var i in this.query.Aggregate[n])r["count("+(e=this.query.Aggregate[n][i])+")"]=o();break;case"max":var c=function(){var r=0;for(var n in t)r=r>t[n][e]?r:t[n][e];return r};if(this.getType(this.query.Aggregate[n])===s.String)r["max("+(e=this.query.Aggregate[n])+")"]=c();else if(this.getType(this.query.Aggregate[n])===s.Array)for(var i in this.query.Aggregate[n])r["max("+(e=this.query.Aggregate[n][i])+")"]=c();break;case"min":var u=function(){var r=1/0,n=1/0;for(var o in t)r=r<(n=t[o][e]?t[o][e]:1/0)?r:n;return r};if(this.getType(this.query.Aggregate[n])===s.String)r["min("+(e=this.query.Aggregate[n])+")"]=u();else if(this.getType(this.query.Aggregate[n])===s.Array)for(var i in this.query.Aggregate[n])r["min("+(e=this.query.Aggregate[n][i])+")"]=u();break;case"sum":var a=function(){var r=0;for(var n in t)r+=t[n][e];return r};if(this.getType(this.query.Aggregate[n])===s.String)r["sum("+(e=this.query.Aggregate[n])+")"]=a();else if(this.getType(this.query.Aggregate[n])===s.Array)for(var i in this.query.Aggregate[n])r["sum("+(e=this.query.Aggregate[n][i])+")"]=a();break;case"avg":var h=function(){var r=0;for(var n in t)r+=t[n][e];return r/t.length};if(this.getType(this.query.Aggregate[n])===s.String)r["avg("+(e=this.query.Aggregate[n])+")"]=h();else if(this.getType(this.query.Aggregate[n])===s.Array)for(var i in this.query.Aggregate[n])r["avg("+(e=this.query.Aggregate[n][i])+")"]=h()}for(var n in r)t[0][n]=r[n];this.results=t},t}(ne),se=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ce=function(e){function t(t,r,n){var o=e.call(this)||this;return o.onError=n,o.onSuccess=r,o.query=t,o.skipRecord=t.skip,o.limitRecord=t.limit,o.tableName=t.from,o}return se(t,e),t.prototype.execute=function(){if(!0===this.isTableExist(this.tableName))try{void 0!==this.query.where?(this.addGreatAndLessToNotOp(),this.initTransaction_(),Array.isArray(this.query.where)?this.processWhereArrayQry():this.processWhere_()):(this.initTransaction_(),this.executeWhereUndefinedLogic())}catch(e){this.errorOccured=!0,this.onExceptionOccured(e,{TableName:this.query.from})}else this.errorOccured=!0,this.onErrorOccured(new f(c.TableNotExist,{TableName:this.query.from}),!0)},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var t,r=this.query.where,n=this.getPrimaryKey(this.query.from),o=!0,i=[],s=function(){if(t===u.And){var s=function(){var t=[];e.results.forEach(function(e){var r,o;r=e[n],o=!1,i.every(function(e){return e[n]!==r||(o=!0,!1)}),o&&t.push(e)}),i=t,t=null};i.length>0?s():!0===o?i=e.results:s()}else i.length>0?(e.results=i.concat(e.results),e.removeDuplicates(),i=e.results):i=e.results;r.length>0?(e.results=[],c()):e.results=i,o=!1},c=function(){e.query.where=r.shift(),e.query.where.or&&1===Object.keys(e.query.where).length?(t="or",e.query.where=e.query.where.or,e.onWhereArrayQrySuccess=s):(t="and",e.onWhereArrayQrySuccess=s),e.processWhere_()};c()},t.prototype.onQueryFinished=function(){!0===this.isOr?this.orQuerySuccess_():!0===this.isArrayQry?this.onWhereArrayQrySuccess():!0===this.isTransaction&&this.onTransactionCompleted_()},t.prototype.initTransaction_=function(){this.createTransaction([this.tableName],this.onTransactionCompleted_,a.ReadOnly),this.objectStore=this.transaction.objectStore(this.tableName)},t.prototype.processWhere_=function(){this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic()},t.prototype.onTransactionCompleted_=function(){if(!1===this.errorOccured){if(this.processOrderBy(),this.query.distinct){var e=[],t=this.results[0];for(var r in t)e.push(r);var n=this.getPrimaryKey(this.query.from),o=e.indexOf(n);e.splice(o,1),this.query.groupBy=e.length>0?e:null}this.query.from?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry(),this.onSuccess(this.results)}},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=void 0,this.removeDuplicates(),this.onQueryFinished()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=this.orInfo.results.concat(this.orInfo.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var e=this.getObjectFirstKey(this.orInfo.orQuery);if(null!=e){var t={};t[e]=this.orInfo.orQuery[e],delete this.orInfo.orQuery[e],this.query.where=t,this.goToWhereLogic()}else this.orQueryFinish_()}else this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0,this.orInfo={orQuery:this.query.where.or,results:[]},delete this.query.where.or},t}(ie),ue=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ae=function(e){function t(t,r,n){var o=e.call(this)||this;o.queryStack=[],o.currentQueryStackIndex=0,o.onSuccess=r,o.onError=n,o.query=t;var i=[],s=function(e){return void 0!==e.table1?(e.table2.JoinType=void 0===e.join?"inner":e.join.toLowerCase(),o.queryStack.push(e.table2),o.queryStack.length%2==0&&(o.queryStack[o.queryStack.length-1].nextJoin=e.nextJoin),i.push(e.table2.table),s(e.table1)):(o.queryStack.push(e),void i.push(e.table))};(s(t.from),o.queryStack.reverse(),o.errorOccured)||new ce({from:o.queryStack[0].table,where:o.queryStack[0].where},function(e){var t=o.queryStack[0].table;e.forEach(function(e,r){o.results[r]={},o.results[r][t]=e}),o.startExecutionJoinLogic_()},o.onErrorOccured).execute();return o}return ue(t,e),t.prototype.onTransactionCompleted_=function(e){null!=this.onSuccess&&this.queryStack.length===this.currentQueryStackIndex+1&&(this.query[u.Count]?this.onSuccess(this.results.length):(this.query[u.Skip]&&this.query[u.Limit]?(this.results.splice(0,this.query[u.Skip]),this.results.splice(this.query[u.Limit]-1,this.results.length)):this.query[u.Skip]?this.results.splice(0,this.query[u.Skip]):this.query[u.Limit]&&this.results.splice(this.query[u.Limit]-1,this.results.length),this.onSuccess(this.results)))},t.prototype.executeWhereJoinLogic_=function(e,t){var r,n=this,o=[],i=(t.column,this.results),s=i.length,c=0;new ce({from:t.table,order:t.order,where:t.where},function(t){t.forEach(function(t,n){for(var o=0;o<s;o++)r=i[o][e.table][e.column],u(r,t,o)}),n.results=o,n.queryStack.length>n.currentQueryStackIndex+1?n.startExecutionJoinLogic_():n.onTransactionCompleted_(null)},this.onErrorOccured).execute();var u=function(e,r,s){if(o[c]={},e===r[t.column]){o[c][t.table]=r;for(var u=0;u<n.currentQueryStackIndex;u++)o[c][n.queryStack[u].table]=i[s][n.queryStack[u].table];++c}else if("left"===t.joinType){o[c]={},o[c][t.table]=null;for(u=0;u<n.currentQueryStackIndex;u++)o[c][n.queryStack[u].table]=i[s][n.queryStack[u].table];++c}}},t.prototype.executeRightJoin_=function(e,t){var r=this,n=[],o=(t.column,this.results),i=o.length,s=0;new ce({from:t.table,order:t.order,where:t.where},function(c){!function(c){var u=!1;c.forEach(function(r,c){for(s=0;s<i;s++)if(r[t.column]===o[s][e.table][e.column]){u=!0;break}if(n[c]={},n[c][t.table]=r,u){u=!1;for(var a=0;a<this.currentQueryStackIndex;a++)n[c][this.queryStack[a].table]=o[s][this.queryStack[a].table]}else for(a=0;a<this.currentQueryStackIndex;a++)n[c][this.queryStack[a].table]=null},r)}(c),r.results=n,r.queryStack.length>r.currentQueryStackIndex+1?r.startExecutionJoinLogic_():r.onTransactionCompleted_(null)},r.onErrorOccured).execute()},t.prototype.executeWhereUndefinedLogicForJoin_=function(e,t){var r=this,n=[],o=(t.column,this.results),i={},s=o.length,c=0,u=0,a=function(){u<s?r.errorOccured||(i[t.column]=o[u][e.table][e.column],new ce({from:t.table,order:t.order,where:i},function(e){!function(e){if(e.length>0)e.forEach(function(e){n[c]={},n[c][t.table]=e;for(var i=0;i<r.currentQueryStackIndex;i++)n[c][r.queryStack[i].table]=o[u][r.queryStack[i].table];++c});else if("left"===t.joinType){n[c]={},n[c][t.table]=null;for(var i=0;i<r.currentQueryStackIndex;i++)n[c][r.queryStack[i].table]=o[u][r.queryStack[i].table];++c}}(e),++u,a()},r.onErrorOccured.bind(r)).execute()):(r.results=n,r.queryStack.length>r.currentQueryStackIndex+1?r.startExecutionJoinLogic_():r.onTransactionCompleted_(null))};a()},t.prototype.startExecutionJoinLogic_=function(){var e;this.currentQueryStackIndex>=1&&this.currentQueryStackIndex%2==1?(e={column:this.queryStack[this.currentQueryStackIndex].nextJoin.column,table:this.queryStack[this.currentQueryStackIndex].nextJoin.table},this.currentQueryStackIndex++):e=this.queryStack[this.currentQueryStackIndex++];var t=this.queryStack[this.currentQueryStackIndex];"right"===t.joinType?this.executeRightJoin_(e,t):t.where?this.executeWhereJoinLogic_(e,t):this.executeWhereUndefinedLogicForJoin_(e,t)},t}(M),he=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resultCount=0,t.checkFlag=!1,t}return he(t,e),t.prototype.onQueryFinished=function(){!0===this.isTransaction&&this.onTransactionCompleted()},t.prototype.onTransactionCompleted=function(){!1===this.errorOccured&&this.onSuccess(this.resultCount)},t}(U),fe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t.prototype.executeWhereUndefinedLogic=function(){var e=this;if(this.objectStore.count){var t=this.objectStore.count();t.onsuccess=function(){e.resultCount=t.result,e.onQueryFinished()},t.onerror=this.onCursorError}else{var r,n=this.objectStore.openCursor();n.onsuccess=function(e){(r=e.target.result)?(++this._resultCount,r.continue()):this.onQueryFinished()}.bind(this),n.onerror=this.onCursorError}},t}(le),ye=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ye(t,e),t.prototype.executeInLogic=function(e,t){var r,n,o=this,i=this.objectStore.index(e);if(this.checkFlag)for(var s=function(e,s){(n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(o.whereCheckerInstance.check(r.value)&&++o.resultCount,r.continue()):e+1===s&&o.onQueryFinished()},n.onerror=c.onCursorError},c=this,u=0,a=t.length;u<a;u++)s(u,a);else if(this.objectStore.count)for(var h=function(e,r){(n=i.count(IDBKeyRange.only(t[e]))).onsuccess=function(t){o.resultCount+=t.target.result,e+1===r&&o.onQueryFinished()},n.onerror=l.onCursorError},l=this,f=(u=0,t.length);u<f;u++)h(u,f);else for(var p=function(e,s){(n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(++o.resultCount,r.continue()):e+1===s&&o.onQueryFinished()},n.onerror=y.onCursorError},y=this,d=(u=0,t.length);u<d;u++)p(u,d)},t}(pe),be=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return be(t,e),t.prototype.executeLikeLogic=function(e,t,r){var n,o=this;this.compValue=t.toLowerCase(),this.compValueLength=this.compValue.length,this.compSymbol=r;var i=this.objectStore.index(e).openCursor();i.onerror=this.onCursorError,this.checkFlag?i.onsuccess=function(e){(n=e.target.result)?(o.filterOnOccurence(n.key)&&o.whereCheckerInstance.check(n.value)&&++o.resultCount,n.continue()):o.onQueryFinished()}:i.onsuccess=function(e){(n=e.target.result)?(o.filterOnOccurence(n.key)&&++o.resultCount,n.continue()):o.onQueryFinished()}},t}(de),ge=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ge(t,e),t.prototype.executeWhereLogic=function(e,t,r){var n,o,i=this;t=r?t[r]:t,this.checkFlag?(n=this.objectStore.index(e).openCursor(this.getKeyRange(t,r))).onsuccess=function(e){(o=e.target.result)?(i.whereCheckerInstance.check(o.value)&&++i.resultCount,o.continue()):i.onQueryFinished()}:this.objectStore.count?(n=this.objectStore.index(e).count(this.getKeyRange(t,r))).onsuccess=function(){i.resultCount=n.result,i.onQueryFinished()}:(n=this.objectStore.index(e).openCursor(this.getKeyRange(t,r))).onsuccess=function(e){(o=e.target.result)?(++i.resultCount,o.continue()):i.onQueryFinished()},n.onerror=function(e){i.errorOccured=!0,i.onErrorOccured(e)}},t}(_e),me=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Oe=function(e){function t(t,r,n){var o=e.call(this)||this;return o.onError=n,o.onSuccess=r,o.query=t,o}return me(t,e),t.prototype.execute=function(){var e=this;if(this.isTableExist(this.query.from))try{if(void 0!==this.query.where)if(this.addGreatAndLessToNotOp(),this.query.where.Or||Array.isArray(this.query.where))new ce(this.query,function(t){e.resultCount=t.length,e.onTransactionCompleted()},this.onError).execute();else this.initTransaction_(),this.goToWhereLogic();else this.initTransaction_(),this.executeWhereUndefinedLogic()}catch(e){this.onExceptionOccured(e,{TableName:this.query.from})}else this.errorOccured=!0,this.onErrorOccured(new f(c.TableNotExist,{TableName:this.query.From}),!0)},t.prototype.initTransaction_=function(){this.createTransaction([this.query.From],this.onTransactionCompleted,"readonly"),this.objectStore=this.transaction.objectStore(this.query.From)},t}(ve),ke=function(){function e(e,t){this.errorOccured=!1,this.autoIncrementValue={},this.table=e,this.autoIncrementValue=t}return e.prototype.checkAndModifyValue=function(e){var t=this;return this.value=e,this.table.columns.every(function(e){return t.checkAndModifyColumnValue_(e),!t.errorOccured}),this.errorOccured},e.prototype.isNull_=function(e){return V.isNull(e)},e.prototype.getType_=function(e){return V.getType(e)},e.prototype.checkNotNullAndDataType_=function(e){e.notNull&&this.isNull_(this.value[e.name])?this.onValidationError_(c.NullValue,{ColumnName:e.name}):e.dataType&&!this.isNull_(this.value[e.name])&&this.getType_(this.value[e.name])!==e.dataType&&this.onValidationError_(c.BadDataType,{ColumnName:e.name})},e.prototype.checkAndModifyColumnValue_=function(e){e.autoIncrement?this.value[e.name]=++this.autoIncrementValue[e.name]:e.default&&this.isNull_(this.value[e.name])&&(this.value[e.name]=e.default),this.checkNotNullAndDataType_(e)},e.prototype.onValidationError_=function(e,t){this.errorOccured=!0,this.error=new f(e,t)},e}(),Se=function(){function e(e,t){this.table=e,this.values=t}return e.prototype.checkAndModifyValues=function(e){var t=this;this.onFinish=e;var r={};this.table.columns.filter(function(e){return e.autoIncrement}).forEach(function(e){var n="JsStore_"+y.activeDb.name+"_"+t.table.name+"_"+e.name+"_Value";j(n,function(t){r[e.name]=t})}),j("dumy_key",function(e){t.valueCheckerObj=new ke(t.table,r),t.startChecking()},function(e){t.error=e,t.onFinish(!0)})},e.prototype.startChecking=function(){var e=this,t=!1;if(this.values.every(function(r){return!(t=e.valueCheckerObj.checkAndModifyValue(r))}),t)this.error=this.valueCheckerObj.error,this.onFinish(!0);else{for(var r=0,n=Object.keys(this.valueCheckerObj.autoIncrementValue);r<n.length;r++){var o=n[r],i="JsStore_"+y.activeDb.name+"_"+this.table.name+"_"+o+"_Value";A(i,this.valueCheckerObj.autoIncrementValue[o])}j("dumy_key",function(t){e.onFinish(!1)},function(t){e.error=t,e.onFinish(!0)})}},e}(),we=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ce=function(e){function t(t,r,n){var o=e.call(this)||this;return o._valuesAffected=[],o.onError=n,o.query=t,o.onSuccess=r,o.tableName=o.query.into,o}return we(t,e),t.prototype.execute=function(){var e=this,t=this.getTable(this.tableName);if(Array.isArray(this.query.values))if(t)try{if(this.query.skipDataCheck)this.insertData(this.query.values);else{var r=new Se(t,this.query.values);r.checkAndModifyValues(function(t){t?e.onErrorOccured(r.error,!0):e.insertData(r.values),r=void 0})}this.query.values=void 0}catch(e){this.onExceptionOccured(e,{TableName:this.tableName})}else new f(c.TableNotExist,{TableName:this.tableName}).throw();else this.onErrorOccured(new f(c.NotArray),!0)},t.prototype.onTransactionCompleted=function(){!1===this.errorOccured&&this.onSuccess(this.query.return?this._valuesAffected:this.rowAffected)},t.prototype.onQueryFinished=function(){!0===this.isTransaction&&this.onTransactionCompleted()},t.prototype.insertData=function(e){var t,r=this,n=0;t=this.query.return?function(i){if(i){var s=o.add(i);s.onerror=r.onErrorOccured.bind(r),s.onsuccess=function(o){r._valuesAffected.push(i),t.call(r,e[n++])}}else r.onQueryFinished()}:function(i){if(i){var s=o.add(i);s.onerror=r.onErrorOccured.bind(r),s.onsuccess=function(o){++r.rowAffected,t.call(r,e[n++])}}else r.onQueryFinished()},this.createTransaction([this.query.into],this.onTransactionCompleted);var o=this.transaction.objectStore(this.query.into);t(e[n++])},t}(U),qe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkFlag=!1,t}return qe(t,e),t.prototype.onQueryFinished=function(){},t}(U),De=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return De(t,e),t.prototype.executeWhereUndefinedLogic=function(){var e,t=this,r=this.objectStore.openCursor();r.onsuccess=function(r){(e=r.target.result)?(e.delete(),++t.rowAffected,e.continue()):t.onQueryFinished()},r.onerror=function(e){t.errorOccured=!0,t.onErrorOccured(e)}},t}(xe),Ee=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ee(t,e),t.prototype.executeInLogic=function(e,t){var r,n,o=this;if(this.checkFlag)for(var i=function(i,c){s.errorOccured||((n=s.objectStore.index(e).openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)?(o.whereCheckerInstance.check(r.value)&&(r.delete(),++o.rowAffected),r.continue()):i+1===c&&o.onQueryFinished()},n.onerror=s.onCursorError)},s=this,c=0,u=t.length;c<u;c++)i(c,u);else for(var a=function(i,s){h.errorOccured||((n=h.objectStore.index(e).openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)?(r.delete(),++o.rowAffected,r.continue()):i+1===s&&o.onQueryFinished()},n.onerror=h.onCursorError)},h=this,l=(c=0,t.length);c<l;c++)a(c,l)},t}(Te),Ae=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ae(t,e),t.prototype.executeLikeLogic=function(e,t,r){var n,o=this;this.compValue=t.toLowerCase(),this.compValueLength=this.compValue.length,this.compSymbol=r;var i=this.objectStore.index(e).openCursor();i.onerror=function(e){o.errorOccured=!0,o.onErrorOccured(e)},this.checkFlag?i.onsuccess=function(e){(n=e.target.result)?(o.filterOnOccurence(n.key)&&o.whereCheckerInstance.check(n.value)&&(n.delete(),++o.rowAffected),n.continue()):o.onQueryFinished()}:i.onsuccess=function(e){(n=e.target.result)?(o.filterOnOccurence(n.key)&&(n.delete(),++o.rowAffected),n.continue()):o.onQueryFinished()}},t}(je),Le=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Le(t,e),t.prototype.executeWhereLogic=function(e,t,r){var n,o,i=this;t=r?t[r]:t,o=this.objectStore.index(e).openCursor(this.getKeyRange(t,r)),this.checkFlag?o.onsuccess=function(e){(n=e.target.result)?(i.whereCheckerInstance.check(n.value)&&(n.delete(),++i.rowAffected),n.continue()):i.onQueryFinished()}:o.onsuccess=function(e){(n=e.target.result)?(n.delete(),++i.rowAffected,n.continue()):i.onQueryFinished()},o.onerror=function(e){i.errorOccured=!0,i.onErrorOccured(e)}},t}(Ne),Fe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Be=function(e){function t(t,r,n){var o=e.call(this)||this;return o.query=t,o.onSuccess=r,o.onError=n,o}return Fe(t,e),t.prototype.execute=function(){try{void 0!==this.query.where?(this.addGreatAndLessToNotOp(),this.initTransaction_(),Array.isArray(this.query.where)?this.processWhereArrayQry():this.processWhere_()):(this.initTransaction_(),this.executeWhereUndefinedLogic())}catch(e){this.errorOccured=!0,this.onExceptionOccured(e,{TableName:this.query.from})}},t.prototype.processWhereArrayQry=function(){var e=this;new ce(this.query,function(t){var r=[],n=e.getPrimaryKey(e.query.from);t.forEach(function(e){r.push(e[n])}),t=null,e.query.where={},e.query.where[n]={},e.query.where[n][u.In]=r,e.processWhere_()},this.onError).execute()},t.prototype.processWhere_=function(){this.query.where.or&&this.processOrLogic(),this.goToWhereLogic()},t.prototype.initTransaction_=function(){this.createTransaction([this.query.from],this.onTransactionCompleted_),this.objectStore=this.transaction.objectStore(this.query.from)},t.prototype.onTransactionCompleted_=function(){!1===this.errorOccured&&this.onSuccess(this.rowAffected)},t.prototype.onQueryFinished=function(){!0===this.isOr?this.orQuerySuccess_():!0===this.isTransaction&&this.onTransactionCompleted_()},t.prototype.orQuerySuccess_=function(){var e=this.getObjectFirstKey(this._orInfo.OrQuery);if(null!=e){var t={};t[e]=this._orInfo.OrQuery[e],delete this._orInfo.OrQuery[e],this.query.where=t,this.goToWhereLogic()}else this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0,this._orInfo={OrQuery:this.query.where.Or},delete this.query.where.Or},t}(Ie),Qe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Re=function(e,t){for(var r in e)if("object"!=typeof e[r])t[r]=e[r];else for(var n in e[r]){switch(n){case"+":t[r]+=e[r][n];break;case"-":t[r]-=e[r][n];break;case"*":t[r]*=e[r][n];break;case"/":t[r]/=e[r][n];break;default:t[r]=e[r]}break}return t},Pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkFlag=!1,t}return Qe(t,e),t.prototype.initTransaction=function(){this.createTransaction([this.query.in],this.onTransactionCompleted_),this.objectStore=this.transaction.objectStore(this.query.in)},t.prototype.onQueryFinished=function(){!0===this.isTransaction&&this.onTransactionCompleted_()},t.prototype.onTransactionCompleted_=function(){!1===this.errorOccured&&this.onSuccess(this.rowAffected)},t}(U),Ve=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ve(t,e),t.prototype.executeWhereUndefinedLogic=function(){var e,t=this,r=this.objectStore.openCursor();r.onsuccess=function(r){(e=r.target.result)?(e.update(Re(t.query.Set,e.value)),++t.rowAffected,e.continue()):t.onQueryFinished()},r.onerror=function(e){t.errorOccured=!0,t.onErrorOccured(e)}},t}(Pe),We=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return We(t,e),t.prototype.executeInLogic=function(e,t){var r,n,o=this,i=this.objectStore.index(e),s=function(e){o.errorOccured=!0,o.onErrorOccured(e)};if(this.checkFlag)for(var c=function(e,c){u.errorOccured||((n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(o.whereCheckerInstance.check(r.value)&&(r.update(Re(o.query.Set,r.value)),++o.rowAffected),r.continue()):e+1===c&&o.onQueryFinished()},n.onerror=s)},u=this,a=0,h=t.length;a<h;a++)c(a,h);else for(var l=function(e,c){f.errorOccured||((n=i.openCursor(IDBKeyRange.only(t[e]))).onsuccess=function(t){(r=t.target.result)?(r.update(Re(o.query.Set,r.value)),++o.rowAffected,r.continue()):e+1===c&&o.onQueryFinished()},n.onerror=s)},f=this,p=(a=0,t.length);a<p;a++)l(a,p)},t}(Ke),Ue=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ue(t,e),t.prototype.executeLikeLogic=function(e,t,r){var n,o=this;this.compValue=t.toLowerCase(),this.compValueLength=this.compValue.length,this.compSymbol=r;var i=this.objectStore.index(e).openCursor();i.onerror=function(e){o.errorOccured=!0,o.onErrorOccured(e)},this.checkFlag?i.onsuccess=function(e){(n=e.target.result)?(o.filterOnOccurence(n.key)&&o.whereCheckerInstance.check(n.value)&&(n.update(Re(o.query.Set,n.value)),++o.rowAffected),n.continue()):o.onQueryFinished()}:i.onsuccess=function(e){(n=e.target.result)?(o.filterOnOccurence(n.key)&&(n.update(Re(o.query.Set,n.value)),++o.rowAffected),n.continue()):o.onQueryFinished()}},t}(Je),Me=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.executeWhereLogic_=function(e,t,r){var n,o,i=this;t=r?t[r]:t,o=this.objectStore.index(e).openCursor(this.getKeyRange(t,r)),this.checkFlag?o.onsuccess=function(e){(n=e.target.result)?(i.whereCheckerInstance.check(n.value)&&(n.update(Re(i.query.Set,n.value)),++i.rowAffected),n.continue()):i.onQueryFinished()}:o.onsuccess=function(e){(n=e.target.result)?(n.update(Re(i.query.Set,n.value)),++i.rowAffected,n.continue()):i.onQueryFinished()},o.onerror=function(e){i.errorOccured=!0,i.onErrorOccured(e)}},t}(Ge),He=function(){function e(e){this.table=e}return e.prototype.check=function(e,t){var r=null;return"object"==typeof e?this.table?this.table.columns.every(function(t){return null===r&&(t.name in e&&(r=this.checkByColumn(t,e[t.name])),!0)},this):r=new f(c.TableNotExist,{TableName:t}):r=new f(c.NotObject),r},e.prototype.isNull_=function(e){return V.isNull(e)},e.prototype.getType_=function(e){return V.getType(e)},e.prototype.checkByColumn=function(e,t){var r=null;e._notNull&&this.isNull_(t)&&(r=new f(c.NullValue,{ColumnName:e.name}));var n=this.getType_(t);if(e._dataType&&n!==e._dataType&&"object"!==n&&(r=new f(c.BadDataType,{ColumnName:e.name})),"object"===n)for(var o=["+","-","*","/"],i=0,s=Object.keys(t);i<s.length;i++){var u=s[i];o.indexOf(u)<0&&e._dataType&&n!==e._dataType&&(r=new f(c.BadDataType,{ColumnName:e.name}));break}return r},e}(),Xe=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ye=function(e){function t(t,r,n){var o=e.call(this)||this;return o.onSuccess=r,o.onError=n,o.query=t,o}return Xe(t,e),t.prototype.execute=function(){try{this.error=new He(this.getTable(this.query.in)).check(this.query.set,this.query.in),this.error?(this.errorOccured=!0,this.onErrorOccured(this.error,!0)):void 0!==this.query.where?(this.addGreatAndLessToNotOp(),this.query.where.or||Array.isArray(this.query.where)?this.executeComplexLogic_():(this.initTransaction(),this.goToWhereLogic())):(this.initTransaction(),this.executeWhereUndefinedLogic())}catch(e){this.errorOccured=!0,this.onExceptionOccured.call(this,e,{TableName:this.query.in})}},t.prototype.executeComplexLogic_=function(){var e=this;new ce({from:this.query.in,where:this.query.where},function(t){var r,n=e.getPrimaryKey(e.query.in),o=[],i={};t.forEach(function(e){o.push(e[n])}),t=null,i[n]=((r={})[u.In]=o,r),e.query[u.Where]=i,e.initTransaction(),e.goToWhereLogic()},this.onError).execute()},t}(ze),Ze=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$e=function(e){function t(t,r,n){var o=e.call(this)||this;return o.query=t,o.onSuccess=r,o.onError=n,o}return Ze(t,e),t.prototype.execute=function(){var e=this;this.createTransaction([this.query],function(){!1===e.errorOccured&&e.onSuccess()});var t=this.transaction.objectStore(this.query).clear();t.onsuccess=function(t){e.getTable(e.query).columns.forEach(function(t){t.autoIncrement&&A("JsStore_"+e.activeDb.name+"_"+e.query+"_"+t.name+"_Value",0)})},t.onerror=function(t){e.errorOccured=!0,e.onErrorOccured(t)}},t}(U),et=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),tt=function(e){function t(t,r,n){var o=e.call(this)||this;return o.query=t,o.onSuccess=r,o.onError=n,o}return et(t,e),t.prototype.execute=function(){if(Array.isArray(this.query.values))if(!0===this.isTableExist(this.query.into))try{this.bulkinsertData(this.query.values),this.query.values=null}catch(e){this.onExceptionOccured(e,{TableName:this.query.into})}else{new f(c.TableNotExist,{TableName:this.query.into}).throw()}else this.onErrorOccured(new f(c.NotArray),!0)},t.prototype.bulkinsertData=function(e){var t=this;this.createTransaction([this.query.into],function(){t.onSuccess()}),this.objectStore=this.transaction.objectStore(this.query.into);for(var r=0,n=e.length;r<n;r++)this.objectStore.add(e[r])},t}(U);!function(e){e.WorkerNotSupplied="worker_not_supplied",e.IndexedDbUndefined="indexeddb_undefined"}(b||(b={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(_||(_={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null"}(g||(g={}));var rt=function(){function e(){}return e.prototype.checkConnectionAndExecuteLogic=function(e){var t=this;switch(f.log("checking connection and executing request:"+e.name),e.name){case"create_db":case"is_db_exist":case"get_db_version":case"get_db_list":case"get_db_schema":case"open_db":this.executeLogic_(e);break;case"change_log_status":this.changeLogStatus_(e.query.logging);break;default:switch(this.dbStatus_.conStatus){case i.Connected:this.executeLogic_(e);break;case i.Closed:!0===this.isDbDeletedByBrowser_?this.createDb_(null,function(){t.isDbDeletedByBrowser_=!1,t.checkConnectionAndExecuteLogic(e)},e.onError):this.openDb_(this.activeDb_.name,function(){t.checkConnectionAndExecuteLogic(e)},e.onError)}}},e.prototype.changeLogStatus_=function(e){l._isLogEnabled=e},e.prototype.returnResult_=function(e){self.postMessage(e)},e.prototype.executeLogic_=function(e){var t=this,r=function(e){t.returnResult_({returnedValue:e})},n=function(e){t.returnResult_({errorDetails:e,errorOccured:!0})};switch(e.name){case"select":this.select_(e.query,r,n);break;case"insert":this.insert_(e.query,r,n);break;case"update":this.update_(e.query,r,n);break;case"remove":this.remove_(e.query,r,n);break;case"is_db_exist":this.isDbExist_(e.query,r,n);break;case"get_db_version":this.getDbVersion_(e.query,r);break;case"get_db_list":this.getDbList_(r);break;case"get_db_schema":this.getDbSchema_(e.query,r);break;case"open_db":!0===this.isDbDeletedByBrowser_?this.createDb_(null,function(){t.isDbDeletedByBrowser_=!1,r()},n):this.openDb_(e.query,r,n);break;case"create_db":this.createDb_(e.query,r,n);break;case"clear":this.clear_(e.query,r,n);break;case"drop_db":this.dropDb_(r,n);break;case"count":this.count_(e.query,r,n);break;case"bulk_insert":this.bulkInsert_(e.query,r,n);break;case"export_json":this.exportJson_(e.query,r,n);break;default:console.error("The Api:-"+e.name+" does not support.")}},e.prototype.getDbSchema_=function(e,t){y.getDbSchema(e,t)},Object.defineProperty(e.prototype,"isDbDeletedByBrowser_",{get:function(){return y.isDbDeletedByBrowser},set:function(e){y.isDbDeletedByBrowser=e},enumerable:!0,configurable:!0}),e.prototype.getDbList_=function(e){y.getDbList(e)},Object.defineProperty(e.prototype,"activeDb_",{get:function(){return y.activeDb},set:function(e){y.activeDb=e},enumerable:!0,configurable:!0}),e.prototype.openDb_=function(e,t,r){var n=this;this.getDbVersion_(e,function(o){if(0!==o)y.activeDbVersion=o,n.getDbSchema_(e,function(e){n.activeDb_=e,new L(t,r).execute()});else{var i=new f(c.DbNotExist,{DbName:e});i.logError(),r(i.get())}})},e.prototype.closeDb_=function(){y.dbStatus.conStatus===i.Connected&&(y.dbStatus.conStatus=i.ClosedByJsStore,y.dbConnection.close())},e.prototype.dropDb_=function(e,t){this.closeDb_(),new p(e,t).deleteDb()},e.prototype.update_=function(e,t,r){new Ye(e,t,r).execute()},e.prototype.insert_=function(e,t,r){new Ce(e,t,r).execute()},e.prototype.bulkInsert_=function(e,t,r){new tt(e,t,r).execute()},e.prototype.remove_=function(e,t,r){new Be(e,t,r).execute()},e.prototype.select_=function(e,t,r){"object"==typeof e.From?new ae(e,t,r):new ce(e,t,r).execute()},e.prototype.count_=function(e,t,r){if("object"==typeof e.From){e.Count=!0;new ae(e,t,r)}else{new Oe(e,t,r).execute()}},e.prototype.createDb_=function(e,t,r){var n=this,o=function(){A("JsStore_"+n.activeDb_.name+"_Schema",n.activeDb_),new F(y.activeDb).createMetaData(function(e){new B(e,t,r)})};null==e?o():(this.closeDb_(),this.getDbVersion_(e.name,function(t){n.activeDbVersion_=t||1,y.activeDb=new P(e),o()}))},Object.defineProperty(e.prototype,"activeDbVersion_",{get:function(){return y.activeDbVersion},set:function(e){y.activeDbVersion=e},enumerable:!0,configurable:!0}),e.prototype.getDbVersion_=function(e,t){y.getDbVersion(e,t)},Object.defineProperty(e.prototype,"dbStatus_",{get:function(){return y.dbStatus},enumerable:!0,configurable:!0}),e.prototype.clear_=function(e,t,r){new $e(e,t,r).execute()},e.prototype.exportJson_=function(e,t,r){this.select_(e,function(e){var r=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"text/json"}));t(r)},function(e){r(e)})},e.prototype.getType=function(e){return V.getType(e)},e.prototype.isDbExist_=function(e,t,r){if(this.dbStatus_.conStatus!==i.UnableToStart)this.getType(e)===g.String?this.getDbVersion_(e,function(e){t(Boolean(e))}):this.getDbVersion_(e.dbName,function(r){t(e.table.version<=r)});else{var n={message:null,type:this.dbStatus_.lastError};switch(n.type){case c.IndexedDbBlocked:n.message="IndexedDB is blocked";break;case c.IndexedDbUndefined:n.message="IndexedDB is not supported"}r(n)}},e}();r.d(t,"registerEvents",function(){return nt});var nt=function(){self.onmessage=function(e){var t;t="Request executing from WebWorker, request name: "+e.data.Name,f.log(t),(new rt).checkConnectionAndExecuteLogic(e.data)}};nt(),E.setDbType(),indexedDB&&T.prcoessQuery({Name:"create_db",Query:null})}]);