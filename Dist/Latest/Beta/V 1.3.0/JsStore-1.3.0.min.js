/** JsStore.js - v1.3.0 - 22/11/2017
 * https://github.com/ujjwalguptaofficial/JsStore
 * Copyright (c) 2017 @Ujjwal Gupta; Licensed MIT */ 
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),KeyStore;!function(e){var t=function(){function e(){}return e.setDbType=function(){self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB?(self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):self.alert?JsStore.Status={ConStatus:JsStore.ConnectionStatus.UnableToStart,LastError:JsStore.ErrorType.IndexedDbUndefined}:(console.log("worked failed"),self.postMessage("message:WorkerFailed"))},e}();e.Utils=t}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_connected"}(e.ConnectionStatus||(e.ConnectionStatus={})),e.RequestQueue=[],e.TableName="LocalStore",e.IsCodeExecuting=!1}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.prcoessExecutionOfCode=function(t){e.RequestQueue.push(t),1==e.RequestQueue.length&&e.executeCode()},e.executeCode=function(){if(!e.IsCodeExecuting&&e.RequestQueue.length>0){e.IsCodeExecuting=!0;var t={Name:e.RequestQueue[0].Name,Query:e.RequestQueue[0].Query};e.executeCodeDirect(t)}},e.executeCodeDirect=function(t){var r=this;new e.Business.Main(function(e){r.processFinishedRequest(e)}).checkConnectionAndExecuteLogic(t)},e.processFinishedRequest=function(t){var r=e.RequestQueue.shift();e.IsCodeExecuting=!1,t.ErrorOccured?r.OnError?r.OnError(t.ErrorDetails):console.log(t.ErrorDetails):r.OnSuccess&&(null!=t.ReturnedValue?r.OnSuccess(t.ReturnedValue):r.OnSuccess()),this.executeCode()}}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){return function(){this.Results=null,this.ErrorOccured=!1,this.ErrorCount=0,this.onErrorOccured=function(e){1==++this.ErrorCount&&null!=this.OnError&&this.OnError(e.target.error),console.error(e)}}}();e.Base=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(t){function r(r,n,o){var s=t.call(this)||this;s.get=function(){var e=this;for(var t in this.Query.Where){!function(t,r){var n=e.ObjectStore.index(t).openCursor(IDBKeyRange.only(r));n.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)},n.onsuccess=function(t){var r=t.target.result;r&&(e.Results=r.value.Value)}}(t,this.Query.Where[t]);break}};var u=s;return s.Query=r,s.OnError=o,s.Transaction=e.DbConnection.transaction([r.From],"readonly"),s.ObjectStore=s.Transaction.objectStore(r.From),s.Transaction.oncomplete=function(e){null!=n&&n(u.Results)},s.get(),s}return __extends(r,t),r}(e.Base);e.Get=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(t){function r(r,n,o){var s=t.call(this)||this;s.setData=function(e){var t=this,r=function(){t.ObjectStore.add(e).onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}};!function(){var n=t.ObjectStore.index("Key").openCursor(IDBKeyRange.only(e.Key));n.onsuccess=function(t){var n=t.target.result;n?(n.value.Value=e.Value,n.update(n.value)):r()},n.onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}}()};try{s.OnError=o,s.Transaction=e.DbConnection.transaction([r.TableName],"readwrite"),s.ObjectStore=s.Transaction.objectStore(r.TableName),s.Transaction.oncomplete=function(e){null!=n&&n()},s.setData(r.Set)}catch(e){console.error(e)}return s}return __extends(r,t),r}(e.Base);e.Set=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(t){function r(r,n,o){var s=t.call(this)||this;s.RowAffected=0,s.remove=function(){var e=this;for(var t in this.Query.Where){e.ErrorOccured||function(t,r){var n=e.ObjectStore.index(t).openCursor(IDBKeyRange.only(r));n.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)},n.onsuccess=function(t){var r=t.target.result;r&&(r.delete(),++e.RowAffected,r.continue())}}(t,e.Query.Where[t]);break}};var u=s;return s.Query=r,s.OnError=o,s.Transaction=e.DbConnection.transaction([r.From],"readwrite"),s.ObjectStore=s.Transaction.objectStore(r.From),s.Transaction.oncomplete=function(){null!=n&&n(u.RowAffected)},s.Transaction.onerror=function(e){u.onErrorOccured(e)},s.remove(),s}return __extends(r,t),r}(e.Base);e.Remove=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(t){var r=function(){return function(r,n,o,s){var u=self.indexedDB.open(r,1);u.onerror=function(e){"InvalidStateError"==e.target.error.name&&(JsStore.Status={ConStatus:JsStore.ConnectionStatus.UnableToStart,LastError:JsStore.ErrorType.IndexedDbBlocked}),null!=s&&s(e.target.error)},u.onsuccess=function(r){t.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=u.result,t.DbConnection.onclose=function(){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection Closed"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(e){t.Status.LastError="Error occured in connection :"+e.target.result},t.DbConnection.onabort=function(r){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection aborted"},null!=o&&o()},u.onupgradeneeded=function(e){e.target.result.createObjectStore(n,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}();t.InitDb=r}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(t){t.Status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""};var r=function(){return function(r){void 0===r&&(r=null),this.checkConnectionAndExecuteLogic=function(r){if("create_db"==r.Name||"open_db"==r.Name)this.executeLogic(r);else if(t.Status.ConStatus==e.ConnectionStatus.Connected)this.executeLogic(r);else if(t.Status.ConStatus==e.ConnectionStatus.NotStarted)n=this,setTimeout(function(){n.checkConnectionAndExecuteLogic(r)},100);else if(t.Status.ConStatus==e.ConnectionStatus.Closed){var n=this;this.createDb(e.TableName,function(){n.checkConnectionAndExecuteLogic(r)},100)}},this.returnResult=function(e){this.OnSuccess&&this.OnSuccess(e)},this.executeLogic=function(e){var t=this,r=function(e){t.returnResult({ReturnedValue:e})},n=function(e){t.returnResult({ErrorOccured:!0,ErrorDetails:e})};switch(e.Name){case"get":this.get(e.Query,r,n);break;case"set":this.set(e.Query,r,n);break;case"remove":this.remove(e.Query,r,n);break;case"create_db":this.createDb(e.Query,r,n)}},this.set=function(e,r,n){new t.Set(e,r,n)},this.remove=function(e,r,n){new t.Remove(e,r,n)},this.get=function(e,r,n){new t.Get(e,r,n)},this.createDb=function(e,r,n){new t.InitDb("KeyStore",e,r,n)},this.OnSuccess=r}}();t.Main=r}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.init=function(){e.Utils.setDbType(),indexedDB&&e.prcoessExecutionOfCode({Name:"create_db",Query:e.TableName})},e.get=function(t,r,n){void 0===n&&(n=null);var o={From:this.TableName,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"get",Query:o,OnSuccess:r,OnError:n}),this},e.set=function(t,r,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var s={TableName:this.TableName,Set:{Key:t,Value:r}};return e.prcoessExecutionOfCode({Name:"set",Query:s,OnSuccess:n,OnError:o}),this},e.remove=function(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var o={From:this.TableName,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"remove",Query:o,OnSuccess:r,OnError:n}),this}}(KeyStore||(KeyStore={}));var JsStore;!function(e){!function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.BadDataType="bad_data_type",e.NextJoinNotExist="next_join_not_exist",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.IndexedDbUndefined="indexeddb_undefined",e.IndexedDbBlocked="indexeddb_blocked"}(e.ErrorType||(e.ErrorType={}));!function(e){e.First="f",e.Last="l",e.Any="a"}(e.Occurence||(e.Occurence={}));!function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(e.WebWorkerStatus||(e.WebWorkerStatus={}));!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start"}(e.ConnectionStatus||(e.ConnectionStatus={}));!function(e){e.In="In",e.Like="Like",e.Or="Or"}(e.WhereQryOption||(e.WhereQryOption={}));!function(e){e.String="string",e.Object="object",e.Array="array"}(e.DataType||(e.DataType={}))}(JsStore||(JsStore={}));var JsStore;!function(e){e.EnableLog=!1,e.DbVersion=0,e.Status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""},e.TempResults=[],e.throwError=function(e){throw e},e.getObjectFirstKey=function(e){for(var t in e)return t;return null},e.log=function(t){e.EnableLog&&console.log(t)},e.logError=function(t){e.EnableLog&&console.error(t)}}(JsStore||(JsStore={}));var JsStore;!function(e){var t=function(){function t(){}return t.getError=function(t,r){var n={Name:t,Message:""};switch(t){case e.ErrorType.NotArray:n.Message="Supplied value is not an array";break;case e.ErrorType.UndefinedColumn:n.Message="Column is undefined in Where";break;case e.ErrorType.UndefinedValue:n.Message="Value is undefined in Where";break;case e.ErrorType.UndefinedColumnName:n.Message="Column name is undefined";break;case e.ErrorType.UndefinedColumnValue:n.Message="Column value is undefined";break;case e.ErrorType.NoValueSupplied:n.Message="No value supplied";break;case e.ErrorType.InvalidOp:n.Message="Invalid Op Value '"+r.Op+"'";break;case e.ErrorType.ColumnNotExist:n.Message="Column '"+r.ColumnName+"' does not exist";break;case e.ErrorType.NullValue:n.Message="Null value is not allowed for column '"+r.ColumnName+"'";break;case e.ErrorType.BadDataType:n.Message="Supplied value for column '"+r.ColumnName+"' does not have valid type";break;case e.ErrorType.NextJoinNotExist:n.Message="Next join details not supplied";break;case e.ErrorType.TableNotExist:n.Message="Table '"+r.TableName+"' does not exist";break;case e.ErrorType.DbNotExist:n.Message="Database '"+r.DbName+"' does not exist";break;default:console.error("the error type is not defined")}return n},t.convertObjectintoLowerCase=function(e){for(var t=Object.keys(e),r=t.length;r--;){var n=t[r];e[n.toLowerCase()]=e[n],delete e[n]}},t.setDbType=function(){self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB?(self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):e.throwError("Your browser doesnot support IndexedDb")},t}();e.Utils=t}(JsStore||(JsStore={}));var JsStore;!function(e){e.isDbExist=function(t,r,n){void 0===n&&(n=null);var o=!r;if(e.Status.ConStatus!=e.ConnectionStatus.UnableToStart){if(o)return new Promise(function(r,n){"string"==typeof t?e.getDbVersion(t,function(e){r(Boolean(e))}):e.getDbVersion(t.DbName,function(e){r(t.Table.Version<=e)})});"string"==typeof t?e.getDbVersion(t,function(e){r(Boolean(e))}):e.getDbVersion(t.DbName,function(e){r(t.Table.Version<=e)})}else{var s={Name:e.Status.LastError,Message:""};switch(s.Name){case e.ErrorType.IndexedDbBlocked:s.Message="IndexedDB is blocked";break;case e.ErrorType.IndexedDbUndefined:s.Message="IndexedDB is not supported"}if(o)return new Promise(function(e,t){t(s)});n&&n(s)}},e.getDbVersion=function(e,t){KeyStore.get("JsStore_"+e+"_Db_Version",function(e){t(Number(e))})},e.getDbSchema=function(e,t){t&&KeyStore.get("JsStore_"+e+"_Schema",function(e){t(e)})},e.isNull=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0==e.length;case"number":return isNaN(e)}return!1},e.enableLog=function(){e.EnableLog=!0,e.WorkerInstance&&e.WorkerInstance.postMessage({Name:"change_log_status",Query:{logging:e.EnableLog}})},e.disableLog=function(){e.EnableLog=!1,e.WorkerInstance&&e.WorkerInstance.postMessage({Name:"change_log_status",Query:{logging:e.EnableLog}})}}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(){return function(t,r){null!=t.Name?this.Name=t.Name:e.throwError("Column Name is not defined for table:"+r),this.AutoIncrement=null!=t.AutoIncrement&&t.AutoIncrement,this.PrimaryKey=null!=t.PrimaryKey&&t.PrimaryKey,this.Unique=null!=t.Unique&&t.Unique,this.NotNull=null!=t.NotNull&&t.NotNull,this.DataType=null!=t.DataType?t.DataType:t.AutoIncrement?"number":null,this.Default=t.Default}}();t.Column=r}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(){function r(e,r){this.Name="",this.Columns=[],this.RequireDelete=!1,this.RequireCreation=!1,this.PrimaryKey="",this.Name=e.Name,this.Version=void 0==e.Version?1:e.Version;var n=this;e.Columns.forEach(function(r){n.Columns.push(new t.Column(r,e.Name))}),this.setRequireDelete(r),this.setDbVersion(r),this.setPrimaryKey(r)}return r.prototype.setPrimaryKey=function(e){var t=this;this.Columns.forEach(function(e){e.PrimaryKey&&(t.PrimaryKey=e.Name)})},r.prototype.setRequireDelete=function(e){var t=this;KeyStore.get("JsStore_"+e+"_"+this.Name+"_Version",function(e){null==e?t.RequireCreation=!0:e<t.Version&&(t.RequireDelete=!0)})},r.prototype.setDbVersion=function(t){var r=this;e.DbVersion=e.DbVersion>r.Version?e.DbVersion:r.Version,KeyStore.set("JsStore_"+t+"_Db_Version",e.DbVersion).set("JsStore_"+t+"_"+r.Name+"_Version",e.DbVersion),r.Version=e.DbVersion},r}();t.Table=r}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){var t=function(){return function(t){this.Tables=[];var r=this;this.Name=t.Name,t.Tables.forEach(function(t){r.Tables.push(new e.Table(t,r.Name))})}}();e.DataBase=t}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){var t=function(){function t(){this.getTable=function(t){var r;return e.ActiveDataBase.Tables.every(function(e){return e.Name!=t||(r=e,!1)}),r},this.getKeyRange=function(e,t){var r;switch(t){case"-":r=IDBKeyRange.bound(e.Low,e.High,!1,!1);break;case">":r=IDBKeyRange.lowerBound(e,!0);break;case">=":r=IDBKeyRange.lowerBound(e);break;case"<":r=IDBKeyRange.upperBound(e,!0);break;case"<=":r=IDBKeyRange.upperBound(e);break;default:r=IDBKeyRange.only(e)}return r},this.getObjectSecondKey=function(e){var t=!1;for(var r in e){if(t)return r;t=!0}},this.getPrimaryKey=function(e){var t=this.getTable(e).PrimaryKey;return t||this.getKeyPath()},this.getKeyPath=function(t){return e.DbConnection.transaction([t],"readonly").objectStore(t).keyPath},this.sortNumberInAsc=function(e){return e.sort(function(e,t){return e-t}),e},this.sortNumberInDesc=function(e){return e.sort(function(e,t){return t-e}),e},this.sortAlphabetInAsc=function(e){return e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),e},this.sortAlphabetInDesc=function(e){return e.sort(function(e,t){return t.toLowerCase().localeCompare(e.toLowerCase())}),e}}return t.prototype.getCombination=function(e){var t=[],r=function(e,n,o){if(o==e.length)t.push(n.join(""));else{var s=e.charAt(o);n[o]=s.toLowerCase(),r(e,n,o+1),n[o]=s.toUpperCase(),r(e,n,o+1)}};return r(e,[],0),t},t.prototype.getAllCombinationOfWord=function(e,t){if(t){for(var r=[],n=0,o=e.length;n<o;n++)r=r.concat(this.getCombination(e[n]));return r}return this.getCombination(e)},t}();e.BaseHelper=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.ErrorOccured=!1,r.ErrorCount=0,r.RowAffected=0,r.SendResultFlag=!0,r.onErrorOccured=function(t,r){if(void 0===r&&(r=!1),1==++this.ErrorCount&&null!=this.OnError){if(r)this.OnError(t);else{var n={Name:t.target.error.name,Message:t.target.error.message};this.OnError(n)}e.logError(n)}},r.onTransactionTimeout=function(e){console.log("transaction timed out")},r.onExceptionOccured=function(t,r){switch(t.name){case"NotFoundError":var n=e.Utils.getError(e.ErrorType.TableNotExist,r);e.throwError(n);default:console.error(t)}},r.goToWhereLogic=function(){var t=e.getObjectFirstKey(this.Query.Where);if(!0===this.Query.IgnoreCase&&(this.Query.Where=this.makeQryInCaseSensitive(this.Query.Where)),this.ObjectStore.indexNames.contains(t)){var r=this.Query.Where[t];if("object"==typeof r){this.CheckFlag=Boolean(Object.keys(r).length>1||Object.keys(this.Query.Where).length>1);var n=e.getObjectFirstKey(r);switch(n){case"Like":var o=r.Like.split("%");o[1]?o.length>2?this.executeLikeLogic(t,o[1],e.Occurence.Any):this.executeLikeLogic(t,o[1],e.Occurence.Last):this.executeLikeLogic(t,o[0],e.Occurence.First);break;case"In":this.executeInLogic(t,r.In);break;case"-":case">":case"<":case">=":case"<=":this.executeWhereLogic(t,r,n);break;case"Aggregate":break;default:this.executeWhereLogic(t,r)}}else this.CheckFlag=Boolean(Object.keys(this.Query.Where).length>1),this.executeWhereLogic(t,r)}else this.ErrorOccured=!0,this.Error=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:t}),e.throwError(this.Error)},r.makeQryInCaseSensitive=function(t){var r,n,o=[];for(var s in t)if("object"==typeof(r=t[s])){for(var u in r)switch(n=r[u],u){case e.WhereQryOption.In:o=o.concat(this.getAllCombinationOfWord(n,!0));break;case e.WhereQryOption.Like:break;default:o=o.concat(this.getAllCombinationOfWord(n))}t[s].In=o}else o=o.concat(this.getAllCombinationOfWord(r)),t[s]={In:o};return t},r}return __extends(r,t),r.prototype.checkForWhereConditionMatch=function(t){var r=this.Query.Where,n=!0;for(var o in r){var s=r[o];if(!n)break;if("object"==typeof s)for(var u in s){if(!n)break;switch(u){case"In":!function(e,t){for(var o=r[e].In,s=0,u=o.length;s<u;s++){if(o[s]==t){n=!0;break}n=!1}}(o,t[o]);break;case"Like":!function(t,o){var s,u,i,c=r[t].Like.split("%");switch(c[1]?(u=c[1],s=c.length>2?e.Occurence.Any:e.Occurence.Last):(u=c[0],s=e.Occurence.First),o=o.toLowerCase(),s){case e.Occurence.Any:(i=o.indexOf(u.toLowerCase()))<0&&(n=!1);break;case e.Occurence.First:((i=o.indexOf(u.toLowerCase()))>0||i<0)&&(n=!1);break;default:(i=o.lastIndexOf(u.toLowerCase()))<o.length-u.length&&(n=!1)}}(o,t[o]);break;case"-":case">":case"<":case">=":case"<=":!function(e,t,o){var s=r[e][o];switch(o){case">":t<=s&&(n=!1);break;case"<":t>=s&&(n=!1);break;case"<=":t>s&&(n=!1);break;case">=":t<s&&(n=!1);break;case"-":(t<s.Low||t>s.High)&&(n=!1)}}(o,t[o],u)}}else if(s!=t[o]){n=!1;break}}return n},r}(t.BaseHelper);t.Base=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(){return function(r,n,o){var s=[],u=indexedDB.open(t.ActiveDataBase.Name,r);u.onerror=function(e){null!=o&&o(e.target.error)},u.onsuccess=function(r){e.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=u.result,t.DbConnection.onclose=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Closed"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(t){e.Status.LastError="Error occured in connection :"+t.target.result},t.DbConnection.onabort=function(t){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection aborted"},null!=n&&n(s),KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_Schema",t.ActiveDataBase)},u.onupgradeneeded=function(e){var r=e.target.result;t.ActiveDataBase.Tables.forEach(function(e){e.RequireDelete?(r.objectStoreNames.contains(e.Name)&&r.deleteObjectStore(e.Name),i(r,e)):e.RequireCreation&&i(r,e)})};var i=function(e,r){try{if(r.PrimaryKey.length>0)n=e.createObjectStore(r.Name,{keyPath:r.PrimaryKey}),r.Columns.forEach(function(e){e.PrimaryKey?n.createIndex(e.Name,e.Name,{unique:!0}):n.createIndex(e.Name,e.Name,{unique:e.Unique}),e.AutoIncrement&&KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+r.Name+"_"+e.Name+"_Value",0)});else{var n=e.createObjectStore(r.Name,{autoIncrement:!0});r.Columns.forEach(function(e){n.createIndex(e.Name,e.Name,{unique:e.Unique}),e.AutoIncrement&&KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+r.Name+"_"+e.Name+"_Value",0)})}s.push(r.Name),KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+r.Name+"_Version",r.Version)}catch(e){console.error(e)}}}}();t.CreateDb=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(){return function(r,n,o){this.deleteDb=function(r,n,o){var s=indexedDB.deleteDatabase(r);s.onblocked=function(){null!=o&&o("database is blocked, cant be deleted right now.")},s.onerror=function(e){null!=o&&o(event.target.error)},s.onsuccess=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_Db_Version"),t.ActiveDataBase.Tables.forEach(function(e){KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_"+e.Name+"_Version"),e.Columns.forEach(function(r){r.AutoIncrement&&KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_"+e.Name+"_"+r.Name+"_Value")})}),KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_Schema"),n()}};var s=this;t.DbConnection.close(),setTimeout(function(){s.deleteDb(r,n,o)},100)}}();t.DropDb=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(r){function n(){var n=null!==r&&r.apply(this,arguments)||this;return n.ValuesAffected=[],n.onTransactionCompleted=function(){this.OnSuccess(this.Query.Return?this.ValuesAffected:this.RowAffected)},n.checkModifyInsertValues=function(r,n){var o,s=this,u=0,i=r.Name,c=function(){o=n[u++],a()},a=function(){o?l():s.insertData(n)},l=function(){var n=0,u=function(a){if(a){var l=function(t,r){s.ErrorOccured=!0,s.Error=e.Utils.getError(t,r)},h=function(){a.NotNull&&e.isNull(o[a.Name])?l(e.ErrorType.NullValue,{ColumnName:a.Name}):a.DataType&&typeof o[a.Name]!=a.DataType&&l(e.ErrorType.BadDataType,{ColumnName:a.Name}),u(r.Columns[n++])};s.ErrorOccured?s.onErrorOccured(s.Error,!0):a.AutoIncrement?KeyStore.get("JsStore_"+t.ActiveDataBase.Name+"_"+i+"_"+a.Name+"_Value",function(e){o[a.Name]=++e,KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+i+"_"+a.Name+"_Value",e),h()}):a.Default&&null==o[a.Name]?(o[a.Name]=a.Default,h()):h()}else c()};u(r.Columns[n++])};c()},n}return __extends(n,r),n}(t.Base);t.InsertHelper=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(r){function n(n,o,s){var u=r.call(this)||this;u.insertData=function(e){var r,n=this,o=0,s=this.Query.Return;r=s?function(t){if(t){var s=u.add(t);s.onerror=function(e){n.onErrorOccured(e)},s.onsuccess=function(s){n.ValuesAffected.push(t),r(e[o++])}}}:function(t){if(t){var s=u.add(t);s.onerror=function(e){n.onErrorOccured(e)},s.onsuccess=function(t){++n.RowAffected,r(e[o++])}}},n.Transaction=t.DbConnection.transaction([n.Query.Into],"readwrite");var u=n.Transaction.objectStore(n.Query.Into);n.Transaction.oncomplete=function(e){n.onTransactionCompleted()},r(e[o++])};try{u.Query=n,u.OnSuccess=o,u.OnError=s;var i=u.getTable(n.Into);if(i)u.Query.SkipDataCheck?(u.insertData(u.Query.Values),u.Query.Values=void 0):(u.checkModifyInsertValues(i,u.Query.Values),u.Query.Values=void 0);else{var c=e.Utils.getError(e.ErrorType.TableNotExist,{TableName:n.Into});e.throwError(c)}}catch(e){u.onExceptionOccured(e,{TableName:n.Into})}return u}return __extends(n,r),n}(t.InsertHelper);t.Insert=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(r){function n(n,o,s){var u=r.call(this)||this;u.ValuesAffected=[],u.ValuesIndex=0,u.onTransactionCompleted=function(){this.OnSuccess(this.Query.Return?this.ValuesAffected:this.RowAffected)},u.bulkinsertData=function(){var e=this;this.Transaction=t.DbConnection.transaction([this.Query.Into],"readwrite"),this.ObjectStore=this.Transaction.objectStore(this.Query.Into),this.Transaction.oncomplete=function(t){e.OnSuccess()},this.Query.Values.forEach(function(t){e.ObjectStore.add(t)})};try{u.Query=n,u.OnSuccess=o,u.OnError=s;if(u.Table=u.getTable(n.Into),u.Table)u.bulkinsertData();else{var i=e.Utils.getError(e.ErrorType.TableNotExist,{TableName:n.Into});e.throwError(i)}}catch(e){u.onExceptionOccured(e,{TableName:n.Into})}return u}return __extends(n,r),n}(t.Base);t.BulkInsert=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(){return function(r,n,o){if(t.ActiveDataBase.Name.length>0){var s=indexedDB.open(t.ActiveDataBase.Name,r);s.onerror=function(e){null!=o&&o(e.target.error)},s.onsuccess=function(r){e.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=s.result,t.DbConnection.onclose=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Closed, trying to reconnect"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(t){e.Status.LastError="Error occured in connection :"+t.target.result},t.DbConnection.onabort=function(t){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Aborted"},null!=n&&n()}}else e.throwError("Database name is not supplied.")}}();t.OpenDb=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){var t=function(t){function r(r,n,o){var s=t.call(this)||this,u=s,i=e.DbConnection.transaction([r],"readwrite").objectStore(r).clear();return i.onsuccess=function(t){u.getTable(r).Columns.forEach(function(t){t.AutoIncrement&&KeyStore.set("JsStore_"+e.ActiveDataBase.Name+"_"+r+"_"+t.Name+"_Value",0)}),null!=n&&n()},i.onerror=function(e){null!=o&&o()},s}return __extends(r,t),r}(e.Base);e.Clear=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var r=function(){return function(r){void 0===r&&(r=null),this.checkConnectionAndExecuteLogic=function(r){switch(e.log("checking connection and executing request:"+r.Name),r.Name){case"create_db":case"open_db":this.executeLogic(r);break;case"change_log_status":this.changeLogStatus(r);default:switch(e.Status.ConStatus){case e.ConnectionStatus.Connected:this.executeLogic(r);break;case e.ConnectionStatus.Closed:var n=this;this.openDb(t.ActiveDataBase.Name,function(){n.checkConnectionAndExecuteLogic(r)})}}},this.changeLogStatus=function(t){!0===t.Query.logging?e.EnableLog=!0:e.EnableLog=!1},this.returnResult=function(e){this.OnSuccess?this.OnSuccess(e):self.postMessage(e)},this.executeLogic=function(e){var t=this,r=function(e){t.returnResult({ReturnedValue:e})},n=function(e){t.returnResult({ErrorOccured:!0,ErrorDetails:e})};switch(e.Name){case"select":this.select(e.Query,r,n);break;case"insert":this.insert(e.Query,r,n);break;case"update":this.update(e.Query,r,n);break;case"delete":this.delete(e.Query,r,n);break;case"open_db":this.openDb(e.Query,r,n);break;case"create_db":this.createDb(e.Query,r,n);break;case"clear":this.clear(e.Query,r,n);break;case"drop_db":this.dropDb(r,n);break;case"count":this.count(e.Query,r,n);break;case"bulk_insert":this.bulkInsert(e.Query,r,n);break;case"export_json":this.exportJson(e.Query,r,n);break;default:console.error("The Api:-"+e.Name+"does not support")}},this.openDb=function(r,n,o){KeyStore.get("JsStore_"+r+"_Db_Version",function(s){if(null==s)throw e.Utils.getError(e.ErrorType.DbNotExist,{DbName:r});KeyStore.get("JsStore_"+r+"_Schema",function(e){t.ActiveDataBase=e,new t.OpenDb(s,n,o)})})},this.closeDb=function(){e.Status.ConStatus==e.ConnectionStatus.Connected&&t.DbConnection.close()},this.dropDb=function(e,r){new t.DropDb(t.ActiveDataBase.Name,e,r)},this.update=function(e,r,n){new t.Update.Instance(e,r,n)},this.insert=function(r,n,o){Array.isArray(r.Values)?new t.Insert(r,n,o):e.throwError("Value should be array :- supplied value is not array")},this.bulkInsert=function(r,n,o){Array.isArray(r.Values)?new t.BulkInsert(r,n,o):e.throwError("Value should be array :- supplied value is not array")},this.delete=function(e,r,n){new t.Delete.Instance(e,r,n)},this.select=function(e,r,n){"object"==typeof e.From?new t.Select.Join(e,r,n):new t.Select.Instance(e,r,n)},this.count=function(e,r,n){"object"==typeof e.From?(e.Count=!0,new t.Select.Join(e,r,n)):new t.Count.Instance(e,r,n)},this.createDb=function(r,n,o){KeyStore.get("JsStore_"+r.Name+"_Db_Version",function(s){e.DbVersion=s,t.ActiveDataBase=new e.Model.DataBase(r);var u=function(){setTimeout(function(){var r=t.ActiveDataBase.Tables[t.ActiveDataBase.Tables.length-1];KeyStore.get("JsStore_"+t.ActiveDataBase.Name+"_"+r.Name+"_Version",function(s){s==r.Version?new t.CreateDb(e.DbVersion,n,o):u()})},200)};u()})},this.clear=function(e,r,n){new t.Clear(e,r,n)},this.exportJson=function(e,t,r){this.select(e,function(e){var r=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"text/json"}));t(r)},function(e){r(e)})},this.OnSuccess=r}}();t.Main=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Results=[],t.Sorted=!1,t.CheckFlag=!1,t.removeDuplicates=function(){var e=this.Results;this.Results=void 0;var t=this.getPrimaryKey(this.Query.From),r={};for(var n in e)r[e[n][t]]=e[n];e=[];for(n in r)e.push(r[n]);this.Results=e},t}return __extends(t,e),t}(e.Base);t.BaseSelect=r}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeWhereUndefinedLogic=function(){var t,r,n=this;if(this.Query.Order&&this.Query.Order.By)if(n.ObjectStore.indexNames.contains(this.Query.Order.By)){var o=this.Query.Order.Type&&"desc"==this.Query.Order.Type.toLowerCase()?"prev":"next";this.Sorted=!0,r=this.ObjectStore.index(n.Query.Order.By).openCursor(null,o)}else{var s=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:this.Query.Order.By});e.throwError(s)}else r=this.ObjectStore.openCursor();this.SkipRecord&&this.LimitRecord?function(){var e=!1;r.onsuccess=function(r){(t=r.target.result)&&(e&&n.Results.length!=n.LimitRecord?(n.Results.push(t.value),t.continue()):(e=!0,t.advance(n.SkipRecord)))}}():this.SkipRecord?function(){var e=!1;r.onsuccess=function(r){(t=r.target.result)&&(e?(n.Results.push(t.value),t.continue()):(e=!0,t.advance(n.SkipRecord)))}}():this.LimitRecord?r.onsuccess=function(e){(t=e.target.result)&&n.Results.length!=n.LimitRecord&&(n.Results.push(t.value),t.continue())}:r.onsuccess=function(e){(t=e.target.result)&&(n.Results.push(t.value),t.continue())},r.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}},r}return __extends(r,t),r}(t.BaseSelect);t.NotWhere=r}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeSkipAndLimitForIn=function(e,t){var r,n=this.SkipRecord,o=this,s=this.ObjectStore.index(e),u=function(e){0==n?o.Results.push(e):--n};if(o.CheckFlag)for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){r=e.target.result,o.Results.length!=o.LimitRecord&&r&&(o.checkForWhereConditionMatch(r.value)&&u(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){r=e.target.result,o.Results.length!=o.LimitRecord&&r&&(u(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)})},t.executeSkipForIn=function(e,t){var r,n=this.SkipRecord,o=this,s=this.ObjectStore.index(e),u=function(e){0==n?o.Results.push(e):--n};if(o.CheckFlag)for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(o.checkForWhereConditionMatch(r.value)&&u(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(u(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)})},t.executeLimitForIn=function(e,t){var r,n=this,o=this.ObjectStore.index(e);if(n.CheckFlag)for(var s=0,u=t.length;s<u;s++)n.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&n.Results.length!=n.LimitRecord&&(n.checkForWhereConditionMatch(r.value)&&n.Results.push(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)});else for(var s=0,u=t.length;s<u;s++)n.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&n.Results.length!=n.LimitRecord&&(n.Results.push(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)})},t.executeSimpleForIn=function(e,t){var r,n=this,o=this.ObjectStore.index(e);if(n.CheckFlag)for(var s=0,u=t.length;s<u;s++)n.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(n.checkForWhereConditionMatch(r.value)&&n.Results.push(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)});else for(var s=0,u=t.length;s<u;s++)n.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(n.Results.push(r.value),r.continue())},this.CursorOpenRequest.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)})},t.executeInLogic=function(e,t){this.SkipRecord&&this.LimitRecord?this.executeSkipAndLimitForIn(e,t):this.SkipRecord?this.executeSkipForIn(e,t):this.LimitRecord?this.executeLimitForIn(e,t):this.executeSimpleForIn(e,t)},t}return __extends(t,e),t}(e.NotWhere);e.In=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.filterOnOccurence=function(t){var r=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(r=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(r=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(r=!0)}return r},r.executeSkipAndLimit=function(){var e,t=this.SkipRecord,r=this,n=function(e){0==t?r.Results.push(e):--t};r.CheckFlag?this.CursorOpenRequest.onsuccess=function(t){e=t.target.result,r.Results.length!=r.LimitRecord&&e&&(r.filterOnOccurence(e.key)&&r.checkForWhereConditionMatch(e.value)&&n(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(t){e=t.target.result,r.Results.length!=r.LimitRecord&&e&&(r.filterOnOccurence(e.key)&&n(e.value),e.continue())}},r.executeSkip=function(){var e,t=this.SkipRecord,r=this,n=function(e){0==t?r.Results.push(e):--t};r.CheckFlag?this.CursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(r.filterOnOccurence(e.key)&&r.checkForWhereConditionMatch(e.value)&&n(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(r.filterOnOccurence(e.key)&&n(e.value),e.continue())}},r.executeLimit=function(){var e,t=this;t.CheckFlag?this.CursorOpenRequest.onsuccess=function(r){e=r.target.result,t.Results.length!=t.LimitRecord&&e&&(t.filterOnOccurence(e.key)&&t.checkForWhereConditionMatch(e.value)&&t.Results.push(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(r){e=r.target.result,t.Results.length!=t.LimitRecord&&e&&(t.filterOnOccurence(e.key)&&t.Results.push(e.value),e.continue())}},r.executeSimple=function(){var e,t=this;t.CheckFlag?this.CursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t.filterOnOccurence(e.key)&&t.checkForWhereConditionMatch(e.value)&&t.Results.push(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t.filterOnOccurence(e.key)&&t.Results.push(e.value),e.continue())}},r.executeLikeLogic=function(e,t,r){var n=this;this.CompValue=t.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=r,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)},this.SkipRecord&&this.LimitRecord?this.executeSkipAndLimit():this.SkipRecord?this.executeSkip():this.LimitRecord?this.executeLimit():this.executeSimple()},r}return __extends(r,t),r}(t.In);t.Like=r}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,r){var n,o,s=this;t=r?t[r]:t,(n=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,r))).onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)},this.SkipRecord&&this.LimitRecord?function(){var e=!1;s.CheckFlag?n.onsuccess=function(t){(o=t.target.result)&&(e&&s.Results.length!=s.LimitRecord?(s.checkForWhereConditionMatch(o.value)&&s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}:n.onsuccess=function(t){(o=t.target.result)&&(e&&s.Results.length!=s.LimitRecord?(s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}}():this.SkipRecord?function(){var e=!1;s.CheckFlag?n.onsuccess=function(t){(o=t.target.result)&&(e?(s.checkForWhereConditionMatch(o.value)&&s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}:n.onsuccess=function(t){(o=t.target.result)&&(e?(s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}}():this.LimitRecord?s.CheckFlag?n.onsuccess=function(e){(o=e.target.result)&&s.Results.length!=s.LimitRecord&&s.checkForWhereConditionMatch(o.value)&&(s.Results.push(o.value),o.continue())}:n.onsuccess=function(e){(o=e.target.result)&&s.Results.length!=s.LimitRecord&&(s.Results.push(o.value),o.continue())}:s.CheckFlag?n.onsuccess=function(e){(o=e.target.result)&&(s.checkForWhereConditionMatch(o.value)&&s.Results.push(o.value),o.continue())}:n.onsuccess=function(e){(o=e.target.result)&&(s.Results.push(o.value),o.continue())}},t}return __extends(t,e),t}(e.Like);e.Where=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(t){function r(r,n,o){var s=t.call(this)||this;s.QueryStack=[],s.CurrentQueryStackIndex=0,s.onTransactionCompleted=function(e){null!=this.OnSuccess&&this.QueryStack.length==this.CurrentQueryStackIndex+1&&(this.Query.Count?this.OnSuccess(this.Results.length):(this.Query.Skip&&this.Query.Limit?(this.Results.splice(0,this.Query.Skip),this.Results.splice(this.Query.Limit-1,this.Results.length)):this.Query.Skip?this.Results.splice(0,this.Query.Skip):this.Query.Limit&&this.Results.splice(this.Query.Limit-1,this.Results.length),this.OnSuccess(this.Results)))},s.executeWhereJoinLogic=function(t,r){var n,o=this,s=[],u=0,i=(r.Column,o.Results),c=i.length;new e.Instance({From:r.Table,Where:r.Where,Order:r.Order},function(e){e.forEach(function(e,r){for(var o=0;o<c;o++)n=i[o][t.Table][t.Column],a(n,e,o)}),o.Results=s,o.QueryStack.length>o.CurrentQueryStackIndex+1?o.startExecutionJoinLogic():o.onTransactionCompleted(null)},function(e){o.onErrorOccured(e)});var a=function(e,t,n){if(s[u]={},e==t[r.Column]){s[u][r.Table]=t;for(c=0;c<o.CurrentQueryStackIndex;c++)s[u][o.QueryStack[c].Table]=i[n][o.QueryStack[c].Table];++u}else if("left"==r.JoinType){s[u]={},s[u][r.Table]=null;for(var c=0;c<o.CurrentQueryStackIndex;c++)s[u][o.QueryStack[c].Table]=i[n][o.QueryStack[c].Table];++u}}},s.executeRightJoin=function(t,r){var n=this,o=[],s=(r.Column,n.Results),u=s.length,i=0,c=function(){n.Results=o,n.QueryStack.length>n.CurrentQueryStackIndex+1?n.startExecutionJoinLogic():n.onTransactionCompleted(null)},a=function(e){var c=!1;e.forEach(function(e,a){for(i=0;i<u;i++)if(e[r.Column]==s[i][t.Table][t.Column]){c=!0;break}if(o[a]={},o[a][r.Table]=e,c){c=!1;for(l=0;l<n.CurrentQueryStackIndex;l++)o[a][n.QueryStack[l].Table]=s[i][n.QueryStack[l].Table]}else for(var l=0;l<n.CurrentQueryStackIndex;l++)o[a][n.QueryStack[l].Table]=null})};new e.Instance({From:r.Table,Where:r.Where,Order:r.Order},function(e){a(e),c()},function(e){n.ErrorOccured=!0,n.onErrorOccured(e)})},s.executeWhereUndefinedLogicForJoin=function(t,r){var n=this,o=[],s=0,u=(r.Column,n.Results),i=u.length,c=0,a={},l=function(){n.Results=o,n.QueryStack.length>n.CurrentQueryStackIndex+1?n.startExecutionJoinLogic():n.onTransactionCompleted(null)},h=function(e){if(e.length>0)e.forEach(function(e){o[s]={},o[s][r.Table]=e;for(var t=0;t<n.CurrentQueryStackIndex;t++)o[s][n.QueryStack[t].Table]=u[c][n.QueryStack[t].Table];++s});else if("left"==r.JoinType){o[s]={},o[s][r.Table]=null;for(var t=0;t<n.CurrentQueryStackIndex;t++)o[s][n.QueryStack[t].Table]=u[c][n.QueryStack[t].Table];++s}},f=function(){c<i?n.ErrorOccured||(a[r.Column]=u[c][t.Table][t.Column],new e.Instance({From:r.Table,Where:a,Order:r.Order},function(e){h(e),++c,f()},function(e){n.ErrorOccured=!0,n.onErrorOccured(e)})):l()};f()},s.OnSuccess=n,s.OnError=o,s.Query=r;var u=s,i=[],c=function(e){return e.hasOwnProperty("Table1")?(e.Table2.JoinType=void 0==e.Join?"inner":e.Join.toLowerCase(),u.QueryStack.push(e.Table2),u.QueryStack.length%2==0&&(u.QueryStack[u.QueryStack.length-1].NextJoin=e.NextJoin),i.push(e.Table2.Table),c(e.Table1)):(u.QueryStack.push(e),void i.push(e.Table))};return c(r.From),s.QueryStack.reverse(),s.ErrorOccured||new e.Instance({From:s.QueryStack[0].Table,Where:s.QueryStack[0].Where},function(e){var t=u.QueryStack[0].Table;e.forEach(function(e,r){u.Results[r]={},u.Results[r][t]=e}),u.startExecutionJoinLogic()},function(e){u.onErrorOccured(e)}),s}return __extends(r,t),r.prototype.startExecutionJoinLogic=function(){var e;this.CurrentQueryStackIndex>=1&&this.CurrentQueryStackIndex%2==1?(e={Table:this.QueryStack[this.CurrentQueryStackIndex].NextJoin.Table,Column:this.QueryStack[this.CurrentQueryStackIndex].NextJoin.Column},this.CurrentQueryStackIndex++):e=this.QueryStack[this.CurrentQueryStackIndex++];var t=this.QueryStack[this.CurrentQueryStackIndex];"right"==t.JoinType?this.executeRightJoin(e,t):t.Where?this.executeWhereJoinLogic(e,t):this.executeWhereUndefinedLogicForJoin(e,t)},r}(e.BaseSelect);e.Join=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.executeAggregateGroupBy=function(){var e=this.Query.GroupBy,t=this.Results,r={};this.Results=void 0;var n=this.Query.Aggregate;this.Query.Aggregate=void 0;var o,s,u,i,c=function(){for(var e in n)switch(e){case"Count":var c=function(){return u=r[s],u=u?u["Count("+i+")"]:0,u+=t[o][i]?1:0};if("string"==typeof n[e])i=n[e],t[o]["Count("+i+")"]=c();else if(Array.isArray(n[e]))for(var a in n[e])i=n[e][a],t[o]["Count("+i+")"]=c();break;case"Max":var l=function(){return u=r[s],u=u?u["Max("+i+")"]:0,t[o][i]=t[o][i]?t[o][i]:0,u>t[o][i]?u:t[o][i]};if("string"==typeof n[e])i=n[e],t[o]["Max("+i+")"]=l();else if(Array.isArray(n[e]))for(var a in n[e])i=n[e][a],t[o]["Max("+i+")"]=l();break;case"Min":var h=function(){return u=r[s],u=u?u["Min("+i+")"]:1/0,t[o][i]=t[o][i]?t[o][i]:1/0,u<t[o][i]?u:t[o][i]};if("string"==typeof n[e])i=n[e],t[o]["Min("+i+")"]=h();else if(Array.isArray(n[e]))for(var a in n[e])i=n[e][a],t[o]["Min("+i+")"]=h();break;case"Sum":var f=function(){return u=r[s],u=u?u["Sum("+i+")"]:0,u+=t[o][i]?t[o][i]:0};if("string"==typeof n[e])i=n[e],t[o]["Sum("+i+")"]=f();else if(Array.isArray(n[e]))for(var a in n[e])i=n[e][a],t[o]["Sum("+i+")"]=f();break;case"Avg":var d=function(){var e=(u=r[s])?u["Sum("+i+")"]:0;e+=t[o][i]?t[o][i]:0,t[o]["Sum("+i+")"]=e,u=u?u["Count("+i+")"]:0,u+=t[o][i]?1:0,t[o]["Count("+i+")"]=u};if("string"==typeof n[e])i=n[e],d();else if(Array.isArray(n[e]))for(var a in n[e])i=n[e][a],d()}};if("string"==typeof e)for(o in t)s=t[o][e],c(),r[s]=t[o];else for(o in t){s="";for(var a in e)s+=t[o][e[a]];c(),r[s]=t[o]}t=[];for(var l in r)t.push(r[l]);if(n.Avg)if("string"==typeof n.Avg)for(o in t){var h=t[o]["Sum("+n.Avg+")"],f=t[o]["Count("+n.Avg+")"];t[o]["Avg("+n.Avg+")"]=h/f,n.Count!==n.Avg&&delete t[o]["Count("+n.Avg+")"],n.Sum!==n.Avg&&delete t[o]["Sum("+n.Avg+")"]}else{var d=typeof n.Count,S=typeof n.Count;for(o in t)for(var a in n.Avg){var g=n.Avg[a],h=t[o]["Sum("+g+")"],f=t[o]["Count("+g+")"];t[o]["Avg("+g+")"]=h/f,d&&(n.Count!==g?delete t[o]["Count("+g+")"]:-1==n.Count.indexOf(g)&&delete t[o]["Count("+g+")"]),S&&(n.Sum!==g?delete t[o]["Sum("+g+")"]:-1==n.Sum.indexOf(g)&&delete t[o]["Sum("+g+")"])}}this.Results=t},t.processGroupBy=function(){var e=this.Query.GroupBy,t=this.Results,r={};if(this.Results=this.Query.GroupBy=void 0,"string"==typeof e)for(var n in t)r[t[n][e]]=t[n];else{var o;for(var n in t){o="";for(var s in e)o+=t[n][e[s]];r[o]=t[n]}}t=[];for(n in r)t.push(r[n]);this.Results=t},t}return __extends(t,e),t}(e.Where);e.GroupByHelper=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.processOrderBy=function(){var e=this.Query.Order;if(e&&this.Results.length>0&&!this.Sorted&&e.By){e.Type=e.Type?e.Type.toLowerCase():"asc";var t=this,r=e.By;"string"==typeof this.Results[0][r]?"asc"==e.Type?t.Results.sort(function(e,t){return e[r].toLowerCase().localeCompare(t[r].toLowerCase())}):t.Results.sort(function(e,t){return t[r].toLowerCase().localeCompare(e[r].toLowerCase())}):"number"==typeof this.Results[0][r]&&("asc"==e.Type?t.Results.sort(function(e,t){return e[r]-t[r]}):t.Results.sort(function(e,t){return t[r]-e[r]}))}},t.processAggregateQry=function(){var e,t=this.Results,r={};this.Results=void 0;for(var n in this.Query.Aggregate)switch(n){case"Count":var o=function(){var r=0;for(var n in t)r+=t[n][e]?1:0;return r};if("string"==typeof this.Query.Aggregate[n])r["Count("+(e=this.Query.Aggregate[n])+")"]=o();else if(Array.isArray(this.Query.Aggregate[n]))for(var s in this.Query.Aggregate[n])r["Count("+(e=this.Query.Aggregate[n][s])+")"]=o();break;case"Max":var u=function(){var r=0;for(var n in t)r=r>t[n][e]?r:t[n][e];return r};if("string"==typeof this.Query.Aggregate[n])r["Max("+(e=this.Query.Aggregate[n])+")"]=u();else if(Array.isArray(this.Query.Aggregate[n]))for(var s in this.Query.Aggregate[n])r["Max("+(e=this.Query.Aggregate[n][s])+")"]=u();break;case"Min":var i=function(){var r=1/0,n=1/0;for(var o in t)r=r<(n=t[o][e]?t[o][e]:1/0)?r:n;return r};if("string"==typeof this.Query.Aggregate[n])r["Min("+(e=this.Query.Aggregate[n])+")"]=i();else if(Array.isArray(this.Query.Aggregate[n]))for(var s in this.Query.Aggregate[n])r["Min("+(e=this.Query.Aggregate[n][s])+")"]=i();break;case"Sum":var c=function(){var r=0;for(var n in t)r+=t[n][e];return r};if("string"==typeof this.Query.Aggregate[n])r["Sum("+(e=this.Query.Aggregate[n])+")"]=c();else if(Array.isArray(this.Query.Aggregate[n]))for(var s in this.Query.Aggregate[n])r["Sum("+(e=this.Query.Aggregate[n][s])+")"]=c();break;case"Avg":var a=function(){var r=0;for(var n in t)r+=t[n][e];return r/t.length};if("string"==typeof this.Query.Aggregate[n])r["Avg("+(e=this.Query.Aggregate[n])+")"]=a();else if(Array.isArray(this.Query.Aggregate[n]))for(var s in this.Query.Aggregate[n])r["Avg("+(e=this.Query.Aggregate[n][s])+")"]=a()}for(var n in r)t[0][n]=r[n];this.Results=t},t}return __extends(t,e),t}(e.GroupByHelper);e.Helper=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(r){var n=function(r){function n(n,o,s){var u=r.call(this)||this;u.onTransactionCompleted=function(){this.SendResultFlag&&(this.processOrderBy(),this.Query.GroupBy?this.Query.Aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.Query.Aggregate&&this.processAggregateQry(),this.OnSuccess(this.Results))},u.createtransactionForOrLogic=function(e){var r=this;this.Query=e;try{this.Transaction=t.DbConnection.transaction([e.From],"readonly"),this.Transaction.oncomplete=function(e){r.onTransactionCompleted()},this.Transaction.ontimeout=r.onTransactionCompleted,this.ObjectStore=this.Transaction.objectStore(e.From),this.goToWhereLogic()}catch(t){this.onExceptionOccured(t,{TableName:e.From})}},u.orQuerySuccess=function(){this.Results=this.OrInfo.Results,this.OrInfo.Results=void 0,this.removeDuplicates(),this.OrInfo.OnSucess(this.Results)},u.executeOrLogic=function(){this.OrInfo={OrQuery:this.Query.Where.Or,OnSucess:this.OnSuccess,Results:[]},this.TmpQry={From:this.Query.From,Where:{}};this.Query.Where.Or=void 0,this.OnSuccess=function(){if(this.OrInfo.Results=this.OrInfo.Results.concat(this.Results),!this.Query.Limit||this.Query.Limit>this.OrInfo.Results.length){this.Results=[];var t=e.getObjectFirstKey(this.OrInfo.OrQuery);null!=t?(this.TmpQry.Where[t]=this.OrInfo.OrQuery[t],delete this.OrInfo.OrQuery[t],this.createtransactionForOrLogic(this.TmpQry)):this.orQuerySuccess()}else this.orQuerySuccess()}};var i=u;u.Query=n,u.OnSuccess=o,u.OnError=s,u.SkipRecord=u.Query.Skip,u.LimitRecord=u.Query.Limit;try{u.Transaction=t.DbConnection.transaction([n.From],"readonly"),u.Transaction.oncomplete=function(e){i.onTransactionCompleted()},u.Transaction.ontimeout=i.onTransactionCompleted,u.ObjectStore=u.Transaction.objectStore(n.From),n.Where?(n.Where.Or&&u.executeOrLogic(),u.goToWhereLogic()):u.executeWhereUndefinedLogic()}catch(e){u.onExceptionOccured(e,{TableName:n.From})}return u}return __extends(n,r),n}(r.Helper);r.Instance=n}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ResultCount=0,t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);t.BaseCount=r}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e=this;if(this.ObjectStore.count){var t=this.ObjectStore.count();t.onsuccess=function(){e.ResultCount=t.result},t.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}}else{var r,n=this.ObjectStore.openCursor();n.onsuccess=function(t){(r=t.target.result)&&(++e.ResultCount,r.continue())},n.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}}},t}return __extends(t,e),t}(e.BaseCount);e.NotWhere=t}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var r,n,o=this,s=this.ObjectStore.index(e);if(o.CheckFlag)for(var u=0,i=t.length;u<i;u++)o.ErrorOccured||((n=s.openCursor(IDBKeyRange.only(t[u]))).onsuccess=function(e){(r=e.target.result)&&(o.checkForWhereConditionMatch(r.value)&&++o.ResultCount,r.continue())},n.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else if(this.ObjectStore.count)for(var u=0,i=t.length;u<i;u++)o.ErrorOccured||((n=s.count(IDBKeyRange.only(t[u]))).onsuccess=function(e){o.ResultCount+=e.target.result},n.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var u=0,i=t.length;u<i;u++)o.ErrorOccured||((n=s.openCursor(IDBKeyRange.only(t[u]))).onsuccess=function(e){(r=e.target.result)&&(++o.ResultCount,r.continue())},n.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});n.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)}},t}return __extends(t,e),t}(e.NotWhere);e.In=t}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.filterOnOccurence=function(t){var r=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(r=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(r=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(r=!0)}return r},r.executeLikeLogic=function(e,t,r){var n,o=this;this.CompValue=t.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=r,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)},o.CheckFlag?this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(o.filterOnOccurence(n.key)&&o.checkForWhereConditionMatch(n.value)&&++o.ResultCount,n.continue())}:this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(o.filterOnOccurence(n.key)&&++o.ResultCount,n.continue())}},r}return __extends(r,t),r}(t.In);t.Like=r}(t.Count||(t.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,r){var n=this;if(t=r?t[r]:t,n.CheckFlag){(u=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,r))).onsuccess=function(e){(s=e.target.result)&&(n.checkForWhereConditionMatch(s.value)&&++n.ResultCount,s.continue())},u.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}}else if(this.ObjectStore.count){var o=this.ObjectStore.index(e).count(this.getKeyRange(t,r));o.onsuccess=function(){n.ResultCount=o.result},o.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}}else{var s,u=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,r));u.onsuccess=function(e){(s=e.target.result)&&(++n.ResultCount,s.continue())},u.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}}},t}return __extends(t,e),t}(e.Like);e.Where=t}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var r=function(t){function r(r,n,o){var s=t.call(this)||this;s.onTransactionCompleted=function(){this.SendResultFlag&&this.OnSuccess(this.ResultCount)};var u=s;s.Query=r,s.OnSuccess=n,s.OnError=o;try{var i=function(){u.Transaction=e.DbConnection.transaction([r.From],"readonly"),u.ObjectStore=u.Transaction.objectStore(r.From),u.Transaction.oncomplete=function(e){u.onTransactionCompleted()},u.Transaction.ontimeout=u.onTransactionTimeout};void 0!=r.Where?r.Where.Or?new e.Select.Instance(r,function(e){u.ResultCount=e.length,u.onTransactionCompleted()},s.OnError):(i(),s.goToWhereLogic()):(i(),s.executeWhereUndefinedLogic())}catch(e){s.onExceptionOccured(e,{TableName:r.From})}return s}return __extends(r,t),r}(t.Where);t.Instance=r}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){(e.Update||(e.Update={})).updateValue=function(e,t){for(var r in e)if("object"!=typeof e[r])t[r]=e[r];else for(var n in e[r]){switch(n){case"+":t[r]+=e[r][n];break;case"-":t[r]-=e[r][n];break;case"*":t[r]*=e[r][n];break;case"/":t[r]/=e[r][n];break;default:t[r]=e[r]}break}return t};var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);e.BaseUpdate=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var r=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.executeWhereUndefinedLogic=function(){var e,r=this,n=this.ObjectStore.openCursor();n.onsuccess=function(n){(e=n.target.result)&&(e.update(t.updateValue(r.Query.Set,e.value)),++r.RowAffected,e.continue())},n.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)}},r}return __extends(r,e),r}(e.BaseUpdate);t.NotWhere=r}(e.Update||(e.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeInLogic=function(t,r){var n,o,s=this,u=this.ObjectStore.index(t);if(s.CheckFlag)for(var i=0,c=r.length;i<c;i++)s.ErrorOccured||((o=u.openCursor(IDBKeyRange.only(r[i]))).onsuccess=function(t){(n=t.target.result)&&(s.checkForWhereConditionMatch(n.value)&&(n.update(e.updateValue(s.Query.Set,n.value)),++s.RowAffected),n.continue())},o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)});else for(var i=0,c=r.length;i<c;i++)s.ErrorOccured||((o=u.openCursor(IDBKeyRange.only(r[i]))).onsuccess=function(t){(n=t.target.result)&&(n.update(e.updateValue(s.Query.Set,n.value)),++s.RowAffected,n.continue())},o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)});o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)}},r}return __extends(r,t),r}(e.NotWhere);e.In=t}(e.Update||(e.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var r=function(r){function n(){var n=null!==r&&r.apply(this,arguments)||this;return n.filterOnOccurence=function(t){var r=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(r=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(r=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(r=!0)}return r},n.executeLikeLogic=function(e,r,n){var o,s=this;this.CompValue=r.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=n,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)},s.CheckFlag?this.CursorOpenRequest.onsuccess=function(e){(o=e.target.result)&&(s.filterOnOccurence(o.key)&&s.checkForWhereConditionMatch(o.value)&&(o.update(t.updateValue(s.Query.Set,o.value)),++s.RowAffected),o.continue())}:this.CursorOpenRequest.onsuccess=function(e){(o=e.target.result)&&(s.filterOnOccurence(o.key)&&(o.update(t.updateValue(s.Query.Set,o.value)),++s.RowAffected),o.continue())}},n}return __extends(n,r),n}(t.In);t.Like=r}(t.Update||(t.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeWhereLogic=function(t,r,n){var o,s,u=this;r=n?r[n]:r,s=this.ObjectStore.index(t).openCursor(this.getKeyRange(r,n)),u.CheckFlag?s.onsuccess=function(t){(o=t.target.result)&&(u.checkForWhereConditionMatch(o.value)&&(o.update(e.updateValue(u.Query.Set,o.value)),++u.RowAffected),o.continue())}:s.onsuccess=function(t){(o=t.target.result)&&(o.update(e.updateValue(u.Query.Set,o.value)),++u.RowAffected,o.continue())},s.onerror=function(e){u.ErrorOccured=!0,u.onErrorOccured(e)}},r}return __extends(r,t),r}(e.Like);e.Where=t}(e.Update||(e.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(r){var n=function(r){function n(e,n,o){var s=r.call(this)||this;s.onTransactionCompleted=function(){this.OnSuccess(this.RowAffected)},s.createtransactionForOrLogic=function(e){var r=this;this.Query=e;try{this.Transaction=t.DbConnection.transaction([e.In],"readwrite"),this.Transaction.oncomplete=function(e){r.onTransactionCompleted()},this.Transaction.ontimeout=r.onTransactionCompleted,this.ObjectStore=this.Transaction.objectStore(e.In),this.goToWhereLogic()}catch(t){this.onExceptionOccured(t,{TableName:e.From})}},s.executeOrLogic=function(){var e=this;new t.Select.Instance({From:this.Query.In,Where:this.Query.Where},function(t){var r=e.getPrimaryKey(e.Query.In),n=[],o={};t.forEach(function(e){n.push(e[r])}),o[r]={In:n},e.createtransactionForOrLogic({In:e.Query.In,Where:o,Set:e.Query.Set})},this.OnError)};try{if(s.OnSuccess=n,s.OnError=o,s.checkSchema(e.Set,e.In),s.ErrorOccured)s.onErrorOccured(s.Error,!0);else{s.Query=e;var u=s,i=function(){u.Transaction=t.DbConnection.transaction([e.In],"readwrite"),u.ObjectStore=u.Transaction.objectStore(e.In),u.Transaction.oncomplete=function(e){u.onTransactionCompleted()},u.Transaction.ontimeout=u.onTransactionTimeout};e.Where?e.Where.Or?s.executeOrLogic():(i(),s.goToWhereLogic()):(i(),s.executeWhereUndefinedLogic())}}catch(t){s.onExceptionOccured(t,{TableName:e.In})}return s}return __extends(n,r),n.prototype.checkSchema=function(t,r){if(t){var n=this.getTable(r),o=this;if(n){var s=function(t,r){o.ErrorOccured=!0,o.Error=e.Utils.getError(t,r)};n.Columns.every(function(r){if(o.ErrorOccured)return!1;if(r.Name in t){!function(t){if(r.NotNull&&e.isNull(t)&&s(e.ErrorType.NullValue,{ColumnName:r.Name}),r.DataType){var n=typeof t;if(n!=r.DataType)if("object"!=n)s(e.ErrorType.BadDataType,{ColumnName:r.Name});else{var o=["+","-","*","/"];for(var u in t){o.indexOf(u)<0&&s(e.ErrorType.BadDataType,{ColumnName:r.Name});break}}}}(t[r.Name])}return!0})}else{var u=e.Utils.getError(e.ErrorType.TableNotExist,{TableName:r});e.throwError(u)}}else this.ErrorOccured=!0,this.OnSuccess(0)},n}(r.Where);r.Instance=n}(t.Update||(t.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);t.BaseDelete=r}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e,t=this,r=this.ObjectStore.openCursor();r.onsuccess=function(r){(e=r.target.result)&&(e.delete(),++t.RowAffected,e.continue())},r.onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}},t}return __extends(t,e),t}(e.BaseDelete);e.NotWhere=t}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var r,n,o=this;this.ObjectStore.index(e);if(o.CheckFlag)for(var s=0,u=t.length;s<u;s++)o.ErrorOccured||((n=this.ObjectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(r=e.target.result)&&(o.checkForWhereConditionMatch(r.value)&&(r.delete(),++o.RowAffected),r.continue())},n.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var s=0,u=t.length;s<u;s++)o.ErrorOccured||((n=this.ObjectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(r=e.target.result)&&(r.delete(),++o.RowAffected,r.continue())},n.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});n.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)}},t}return __extends(t,e),t}(e.NotWhere);e.In=t}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.filterOnOccurence=function(t){var r=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(r=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(r=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(r=!0)}return r},r.executeLikeLogic=function(e,t,r){var n,o=this;this.CompValue=t.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=r,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)},o.CheckFlag?this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(o.filterOnOccurence(n.key)&&o.checkForWhereConditionMatch(n.value)&&(n.delete(),++o.RowAffected),n.continue())}:this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(o.filterOnOccurence(n.key)&&(n.delete(),++o.RowAffected),n.continue())}},r}return __extends(r,t),r}(t.In);t.Like=r}(t.Delete||(t.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,r){var n,o,s=this;t=r?t[r]:t,o=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,r)),s.CheckFlag?o.onsuccess=function(e){(n=e.target.result)&&(s.checkForWhereConditionMatch(n.value)&&(n.delete(),++s.RowAffected),n.continue())}:o.onsuccess=function(e){(n=e.target.result)&&(n.delete(),++s.RowAffected,n.continue())},o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)}},t}return __extends(t,e),t}(e.Like);e.Where=t}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(r){var n=function(r){function n(n,o,s){var u=r.call(this)||this;u.onTransactionCompleted=function(){this.OnSuccess(this.RowAffected)},u.createtransactionForOrLogic=function(e){var r=this;this.Query=e;try{this.Transaction=t.DbConnection.transaction([e.From],"readwrite"),this.Transaction.oncomplete=function(e){r.onTransactionCompleted()},this.Transaction.ontimeout=r.onTransactionCompleted,this.ObjectStore=this.Transaction.objectStore(e.From),this.goToWhereLogic()}catch(t){this.onExceptionOccured(t,{TableName:e.From})}},u.executeOrLogic=function(){this.OrInfo={OrQuery:this.Query.Where.Or,OnSucess:this.OnSuccess},this.TmpQry={From:this.Query.From,Where:{}};this.Query.Where.Or=void 0,this.OnSuccess=function(){var t=e.getObjectFirstKey(this.OrInfo.OrQuery);null!=t?(this.TmpQry.Where[t]=this.OrInfo.OrQuery[t],delete this.OrInfo.OrQuery[t],this.createtransactionForOrLogic(this.TmpQry)):this.OrInfo.OnSucess(this.RowAffected)}};try{var i=u;u.Query=n,u.OnSuccess=o,u.OnError=s,u.Transaction=t.DbConnection.transaction([n.From],"readwrite"),u.ObjectStore=u.Transaction.objectStore(n.From),u.Transaction.oncomplete=function(){i.onTransactionCompleted()},u.Transaction.onerror=function(e){i.onErrorOccured(e)},n.Where?(n.Where.Or&&u.executeOrLogic(),u.goToWhereLogic()):u.executeWhereUndefinedLogic()}catch(e){u.onExceptionOccured(e,{TableName:n.From})}return u}return __extends(n,r),n}(r.Where);r.Instance=n}(t.Delete||(t.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){e.WorkerStatus=e.WebWorkerStatus.NotStarted;var t=function(){function t(){this.RequestQueue=[],this.IsCodeExecuting=!1,this.pushApi=function(e,t){if(!0===t){var r=this;return new Promise(function(t,n){e.OnSuccess=function(e){t(e)},e.OnError=function(e){n(e)},r.prcoessExecutionOfCode(e)})}return this.prcoessExecutionOfCode(e),this},this.prcoessExecutionOfCode=function(t){if(e.Status.ConStatus==e.ConnectionStatus.NotStarted)switch(t.Name){case"create_db":case"open_db":this.RequestQueue.splice(0,0,t),e.WorkerStatus!=e.WebWorkerStatus.NotStarted&&this.executeCode(),e.Status.ConStatus=e.ConnectionStatus.Connected;break;default:this.RequestQueue.push(t)}else this.RequestQueue.push(t),1==this.RequestQueue.length&&e.WorkerStatus!=e.WebWorkerStatus.NotStarted&&this.executeCode();e.log("request pushed: "+t.Name)},this.executeCode=function(){if(!this.IsCodeExecuting&&this.RequestQueue.length>0){this.IsCodeExecuting=!0;var t=this.RequestQueue[0],r={Name:t.Name,Query:t.Query};e.log("request executing : "+t.Name),e.WorkerStatus==e.WebWorkerStatus.Registered?this.executeCodeUsingWorker(r):this.executeCodeDirect(r)}},this.executeCodeDirect=function(t){var r=this;new e.Business.Main(function(e){r.processFinishedRequest(e)}).checkConnectionAndExecuteLogic(t)},this.executeCodeUsingWorker=function(t){e.WorkerInstance.postMessage(t)},this.processFinishedRequest=function(t){var r=this.RequestQueue.shift();this.IsCodeExecuting=!1,r&&(e.log("request finished : "+r.Name),t.ErrorOccured?r.OnError&&r.OnError(t.ErrorDetails):r.OnSuccess&&(null!=t.ReturnedValue?r.OnSuccess(t.ReturnedValue):r.OnSuccess()),this.executeCode())},this.onWorkerFailed=function(){console.warn("JsStore is not runing in web worker"),e.WorkerStatus=e.WebWorkerStatus.Failed,e.Status.ConStatus==e.ConnectionStatus.NotStarted&&this.executeCode()},this.createWorker=function(){var t=this;try{if(Worker){var r=this.getScriptUrl();r&&r.length>0?(e.WorkerInstance=new Worker(r),e.WorkerInstance.onmessage=function(e){t.onMessageFromWorker(e)},t.executeCodeUsingWorker({Name:"change_log_status",Query:{logging:e.EnableLog}}),setTimeout(function(){e.WorkerStatus!=e.WebWorkerStatus.Failed&&(e.WorkerStatus=e.WebWorkerStatus.Registered),e.Status.ConStatus==e.ConnectionStatus.Connected&&t.executeCode()},100)):t.onWorkerFailed()}else t.onWorkerFailed()}catch(e){t.onWorkerFailed()}},this.onMessageFromWorker=function(e){var t=this;if("string"==typeof e.data)switch(e.data.split(":")[1]){case"WorkerFailed":t.onWorkerFailed()}else this.processFinishedRequest(e.data)}}return t.prototype.getScriptUrl=function(e){for(var t="",r=e?e.toLowerCase():"jsstore",n=document.getElementsByTagName("script"),o=n.length-1,s="";o>=0;o--)if(s=n[o].src,(s=s.substring(s.lastIndexOf("/")+1).toLowerCase()).length>0&&s.indexOf(r)>=0)return t=n[o].src;return t},t}();e.CodeExecutionHelper=t}(JsStore||(JsStore={}));var Model=JsStore.Model,DataBase=Model.DataBase,Column=Model.Column,Table=Model.Table,JsStore;!function(e){var t=function(t){function r(r){void 0===r&&(r=null);var n=t.call(this)||this;return n.openDb=function(e,t,r){return void 0===t&&(t=null),void 0===r&&(r=null),this.pushApi({Name:"open_db",Query:e,OnSuccess:t,OnError:r},!1)},n.createDb=function(e,t,r){return void 0===t&&(t=null),void 0===r&&(r=null),this.pushApi({Name:"create_db",OnSuccess:t,OnError:r,Query:e},!1)},n.dropDb=function(e,t){void 0===t&&(t=null);var r=!e;return this.pushApi({Name:"drop_db",OnSuccess:e,OnError:t},r)},n.select=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"select",Query:e,OnSuccess:t,OnError:r},n)},n.count=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"count",Query:e,OnSuccess:t,OnError:r},n)},n.insert=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"insert",Query:e,OnSuccess:t,OnError:r},n)},n.update=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"update",Query:e,OnSuccess:t,OnError:r},n)},n.delete=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"delete",Query:e,OnSuccess:t,OnError:r},n)},n.clear=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var n=!t;return this.pushApi({Name:"clear",Query:e,OnSuccess:t,OnError:onerror},n)},n.bulkInsert=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r;var n=!t;return e.OnSuccess=e.OnError=null,this.pushApi({Name:"bulk_insert",Query:e,OnSuccess:t,OnError:r},n)},n.exportJson=function(e){var t=function(t){var r=document.createElement("a");r.href=t,r.download=e.From+".json",r.click(),n&&n()},r=e.OnError,n=e.OnSuccess;e.OnSuccess=e.OnError=void 0;var o=!n;if(o)return new Promise(function(n,s){this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:r},o).then(function(e){t(e),n()}).catch(function(e){s(e)})});this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:r},o)},e.WorkerStatus==e.WebWorkerStatus.Registered?e.WorkerInstance.terminate():e.WorkerStatus==e.WebWorkerStatus.NotStarted&&KeyStore.init(),n.createWorker(),r&&n.openDb(r),n}return __extends(r,t),r}(e.CodeExecutionHelper);e.Instance=t}(JsStore||(JsStore={})),self&&!self.alert&&(self.onmessage=function(e){JsStore.log("Request executing from WebWorker, request name: "+e.data.Name);var t=e.data;(new JsStore.Business.Main).checkConnectionAndExecuteLogic(t)},JsStore.WorkerStatus=JsStore.WebWorkerStatus.Registered,KeyStore.init());